(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=i(a);fetch(a.href,s)}})();var me,b,nt,st,j,je,at,rt,ot,Me,Ie,Re,ie={},lt=[],Lt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ve=Array.isArray;function A(t,e){for(var i in e)t[i]=e[i];return t}function Oe(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Mt(t,e,i){var n,a,s,r={};for(s in e)s=="key"?n=e[s]:s=="ref"?a=e[s]:r[s]=e[s];if(arguments.length>2&&(r.children=arguments.length>3?me.call(arguments,2):i),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)r[s]===void 0&&(r[s]=t.defaultProps[s]);return ue(t,r,n,a,null)}function ue(t,e,i,n,a){var s={type:t,props:e,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++nt,__i:-1,__u:0};return a==null&&b.vnode!=null&&b.vnode(s),s}function se(t){return t.children}function ee(t,e){this.props=t,this.context=e}function W(t,e){if(e==null)return t.__?W(t.__,t.__i+1):null;for(var i;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null)return i.__e;return typeof t.type=="function"?W(t):null}function ct(t){var e,i;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null){t.__e=t.__c.base=i.__e;break}return ct(t)}}function ze(t){(!t.__d&&(t.__d=!0)&&j.push(t)&&!de.__r++||je!=b.debounceRendering)&&((je=b.debounceRendering)||at)(de)}function de(){for(var t,e,i,n,a,s,r,u=1;j.length;)j.length>u&&j.sort(rt),t=j.shift(),u=j.length,t.__d&&(i=void 0,n=void 0,a=(n=(e=t).__v).__e,s=[],r=[],e.__P&&((i=A({},n)).__v=n.__v+1,b.vnode&&b.vnode(i),Ne(e.__P,i,n,e.__n,e.__P.namespaceURI,32&n.__u?[a]:null,s,a??W(n),!!(32&n.__u),r),i.__v=n.__v,i.__.__k[i.__i]=i,dt(s,i,r),n.__e=n.__=null,i.__e!=a&&ct(i)));de.__r=0}function ut(t,e,i,n,a,s,r,u,p,c,g){var l,v,_,T,C,R,x,w=n&&n.__k||lt,H=e.length;for(p=Ot(i,e,w,p,H),l=0;l<H;l++)(_=i.__k[l])!=null&&(v=_.__i==-1?ie:w[_.__i]||ie,_.__i=l,R=Ne(t,_,v,a,s,r,u,p,c,g),T=_.__e,_.ref&&v.ref!=_.ref&&(v.ref&&Ae(v.ref,null,_),g.push(_.ref,_.__c||T,_)),C==null&&T!=null&&(C=T),(x=!!(4&_.__u))||v.__k===_.__k?p=ht(_,p,t,x):typeof _.type=="function"&&R!==void 0?p=R:T&&(p=T.nextSibling),_.__u&=-7);return i.__e=C,p}function Ot(t,e,i,n,a){var s,r,u,p,c,g=i.length,l=g,v=0;for(t.__k=new Array(a),s=0;s<a;s++)(r=e[s])!=null&&typeof r!="boolean"&&typeof r!="function"?(p=s+v,(r=t.__k[s]=typeof r=="string"||typeof r=="number"||typeof r=="bigint"||r.constructor==String?ue(null,r,null,null,null):ve(r)?ue(se,{children:r},null,null,null):r.constructor==null&&r.__b>0?ue(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):r).__=t,r.__b=t.__b+1,u=null,(c=r.__i=Nt(r,i,p,l))!=-1&&(l--,(u=i[c])&&(u.__u|=2)),u==null||u.__v==null?(c==-1&&(a>g?v--:a<g&&v++),typeof r.type!="function"&&(r.__u|=4)):c!=p&&(c==p-1?v--:c==p+1?v++:(c>p?v--:v++,r.__u|=4))):t.__k[s]=null;if(l)for(s=0;s<g;s++)(u=i[s])!=null&&(2&u.__u)==0&&(u.__e==n&&(n=W(u)),ft(u,u));return n}function ht(t,e,i,n){var a,s;if(typeof t.type=="function"){for(a=t.__k,s=0;a&&s<a.length;s++)a[s]&&(a[s].__=t,e=ht(a[s],e,i,n));return e}t.__e!=e&&(n&&(e&&t.type&&!e.parentNode&&(e=W(t)),i.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Nt(t,e,i,n){var a,s,r,u=t.key,p=t.type,c=e[i],g=c!=null&&(2&c.__u)==0;if(c===null&&t.key==null||g&&u==c.key&&p==c.type)return i;if(n>(g?1:0)){for(a=i-1,s=i+1;a>=0||s<e.length;)if((c=e[r=a>=0?a--:s++])!=null&&(2&c.__u)==0&&u==c.key&&p==c.type)return r}return-1}function Be(t,e,i){e[0]=="-"?t.setProperty(e,i??""):t[e]=i==null?"":typeof i!="number"||Lt.test(e)?i:i+"px"}function le(t,e,i,n,a){var s,r;e:if(e=="style")if(typeof i=="string")t.style.cssText=i;else{if(typeof n=="string"&&(t.style.cssText=n=""),n)for(e in n)i&&e in i||Be(t.style,e,"");if(i)for(e in i)n&&i[e]==n[e]||Be(t.style,e,i[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(ot,"$1")),r=e.toLowerCase(),e=r in t||e=="onFocusOut"||e=="onFocusIn"?r.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=i,i?n?i.u=n.u:(i.u=Me,t.addEventListener(e,s?Re:Ie,s)):t.removeEventListener(e,s?Re:Ie,s);else{if(a=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&i==1?"":i))}}function De(t){return function(e){if(this.l){var i=this.l[e.type+t];if(e.t==null)e.t=Me++;else if(e.t<i.u)return;return i(b.event?b.event(e):e)}}}function Ne(t,e,i,n,a,s,r,u,p,c){var g,l,v,_,T,C,R,x,w,H,Y,re,G,Ue,oe,J,ke,N=e.type;if(e.constructor!=null)return null;128&i.__u&&(p=!!(32&i.__u),s=[u=e.__e=i.__e]),(g=b.__b)&&g(e);e:if(typeof N=="function")try{if(x=e.props,w="prototype"in N&&N.prototype.render,H=(g=N.contextType)&&n[g.__c],Y=g?H?H.props.value:g.__:n,i.__c?R=(l=e.__c=i.__c).__=l.__E:(w?e.__c=l=new N(x,Y):(e.__c=l=new ee(x,Y),l.constructor=N,l.render=Ht),H&&H.sub(l),l.props=x,l.state||(l.state={}),l.context=Y,l.__n=n,v=l.__d=!0,l.__h=[],l._sb=[]),w&&l.__s==null&&(l.__s=l.state),w&&N.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=A({},l.__s)),A(l.__s,N.getDerivedStateFromProps(x,l.__s))),_=l.props,T=l.state,l.__v=e,v)w&&N.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),w&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(w&&N.getDerivedStateFromProps==null&&x!==_&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(x,Y),!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(x,l.__s,Y)===!1||e.__v==i.__v){for(e.__v!=i.__v&&(l.props=x,l.state=l.__s,l.__d=!1),e.__e=i.__e,e.__k=i.__k,e.__k.some(function(B){B&&(B.__=e)}),re=0;re<l._sb.length;re++)l.__h.push(l._sb[re]);l._sb=[],l.__h.length&&r.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(x,l.__s,Y),w&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(_,T,C)})}if(l.context=Y,l.props=x,l.__P=t,l.__e=!1,G=b.__r,Ue=0,w){for(l.state=l.__s,l.__d=!1,G&&G(e),g=l.render(l.props,l.state,l.context),oe=0;oe<l._sb.length;oe++)l.__h.push(l._sb[oe]);l._sb=[]}else do l.__d=!1,G&&G(e),g=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++Ue<25);l.state=l.__s,l.getChildContext!=null&&(n=A(A({},n),l.getChildContext())),w&&!v&&l.getSnapshotBeforeUpdate!=null&&(C=l.getSnapshotBeforeUpdate(_,T)),J=g,g!=null&&g.type===se&&g.key==null&&(J=pt(g.props.children)),u=ut(t,ve(J)?J:[J],e,i,n,a,s,r,u,p,c),l.base=e.__e,e.__u&=-161,l.__h.length&&r.push(l),R&&(l.__E=l.__=null)}catch(B){if(e.__v=null,p||s!=null)if(B.then){for(e.__u|=p?160:128;u&&u.nodeType==8&&u.nextSibling;)u=u.nextSibling;s[s.indexOf(u)]=null,e.__e=u}else{for(ke=s.length;ke--;)Oe(s[ke]);Pe(e)}else e.__e=i.__e,e.__k=i.__k,B.then||Pe(e);b.__e(B,e,i)}else s==null&&e.__v==i.__v?(e.__k=i.__k,e.__e=i.__e):u=e.__e=At(i.__e,e,i,n,a,s,r,p,c);return(g=b.diffed)&&g(e),128&e.__u?void 0:u}function Pe(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(Pe)}function dt(t,e,i){for(var n=0;n<i.length;n++)Ae(i[n],i[++n],i[++n]);b.__c&&b.__c(e,t),t.some(function(a){try{t=a.__h,a.__h=[],t.some(function(s){s.call(a)})}catch(s){b.__e(s,a.__v)}})}function pt(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:ve(t)?t.map(pt):A({},t)}function At(t,e,i,n,a,s,r,u,p){var c,g,l,v,_,T,C,R=i.props,x=e.props,w=e.type;if(w=="svg"?a="http://www.w3.org/2000/svg":w=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),s!=null){for(c=0;c<s.length;c++)if((_=s[c])&&"setAttribute"in _==!!w&&(w?_.localName==w:_.nodeType==3)){t=_,s[c]=null;break}}if(t==null){if(w==null)return document.createTextNode(x);t=document.createElementNS(a,w,x.is&&x),u&&(b.__m&&b.__m(e,s),u=!1),s=null}if(w==null)R===x||u&&t.data==x||(t.data=x);else{if(s=s&&me.call(t.childNodes),R=i.props||ie,!u&&s!=null)for(R={},c=0;c<t.attributes.length;c++)R[(_=t.attributes[c]).name]=_.value;for(c in R)if(_=R[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=_;else if(!(c in x)){if(c=="value"&&"defaultValue"in x||c=="checked"&&"defaultChecked"in x)continue;le(t,c,null,_,a)}}for(c in x)_=x[c],c=="children"?v=_:c=="dangerouslySetInnerHTML"?g=_:c=="value"?T=_:c=="checked"?C=_:u&&typeof _!="function"||R[c]===_||le(t,c,_,R[c],a);if(g)u||l&&(g.__html==l.__html||g.__html==t.innerHTML)||(t.innerHTML=g.__html),e.__k=[];else if(l&&(t.innerHTML=""),ut(e.type=="template"?t.content:t,ve(v)?v:[v],e,i,n,w=="foreignObject"?"http://www.w3.org/1999/xhtml":a,s,r,s?s[0]:i.__k&&W(i,0),u,p),s!=null)for(c=s.length;c--;)Oe(s[c]);u||(c="value",w=="progress"&&T==null?t.removeAttribute("value"):T!=null&&(T!==t[c]||w=="progress"&&!T||w=="option"&&T!=R[c])&&le(t,c,T,R[c],a),c="checked",C!=null&&C!=t[c]&&le(t,c,C,R[c],a))}return t}function Ae(t,e,i){try{if(typeof t=="function"){var n=typeof t.__u=="function";n&&t.__u(),n&&e==null||(t.__u=t(e))}else t.current=e}catch(a){b.__e(a,i)}}function ft(t,e,i){var n,a;if(b.unmount&&b.unmount(t),(n=t.ref)&&(n.current&&n.current!=t.__e||Ae(n,null,e)),(n=t.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(s){b.__e(s,e)}n.base=n.__P=null}if(n=t.__k)for(a=0;a<n.length;a++)n[a]&&ft(n[a],e,i||typeof t.type!="function");i||Oe(t.__e),t.__c=t.__=t.__e=void 0}function Ht(t,e,i){return this.constructor(t,i)}function ye(t,e,i){var n,a,s,r;e==document&&(e=document.documentElement),b.__&&b.__(t,e),a=(n=!1)?null:e.__k,s=[],r=[],Ne(e,t=e.__k=Mt(se,null,[t]),a||ie,ie,e.namespaceURI,a?null:e.firstChild?me.call(e.childNodes):null,s,a?a.__e:e.firstChild,n,r),dt(s,t,r)}me=lt.slice,b={__e:function(t,e,i,n){for(var a,s,r;e=e.__;)if((a=e.__c)&&!a.__)try{if((s=a.constructor)&&s.getDerivedStateFromError!=null&&(a.setState(s.getDerivedStateFromError(t)),r=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(t,n||{}),r=a.__d),r)return a.__E=a}catch(u){t=u}throw t}},nt=0,st=function(t){return t!=null&&t.constructor==null},ee.prototype.setState=function(t,e){var i;i=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=A({},this.state),typeof t=="function"&&(t=t(A({},i),this.props)),t&&A(i,t),t!=null&&this.__v&&(e&&this._sb.push(e),ze(this))},ee.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),ze(this))},ee.prototype.render=se,j=[],at=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,rt=function(t,e){return t.__v.__b-e.__v.__b},de.__r=0,ot=/(PointerCapture)$|Capture$/i,Me=0,Ie=De(!1),Re=De(!0);var Yt=0;function o(t,e,i,n,a,s){e||(e={});var r,u,p=e;if("ref"in p)for(u in p={},e)u=="ref"?r=e[u]:p[u]=e[u];var c={type:t,props:p,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Yt,__i:-1,__u:0,__source:a,__self:s};if(typeof t=="function"&&(r=t.defaultProps))for(u in r)p[u]===void 0&&(p[u]=r[u]);return b.vnode&&b.vnode(c),c}var ne,I,be,Fe,pe=0,_t=[],P=b,We=P.__b,qe=P.__r,Ve=P.diffed,Ge=P.__c,Je=P.unmount,Ze=P.__;function He(t,e){P.__h&&P.__h(I,t,pe||e),pe=0;var i=I.__H||(I.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({}),i.__[t]}function Xt(t){return pe=1,Ut(yt,t)}function Ut(t,e,i){var n=He(ne++,2);if(n.t=t,!n.__c&&(n.__=[yt(void 0,e),function(u){var p=n.__N?n.__N[0]:n.__[0],c=n.t(p,u);p!==c&&(n.__N=[c,n.__[1]],n.__c.setState({}))}],n.__c=I,!I.__f)){var a=function(u,p,c){if(!n.__c.__H)return!0;var g=n.__c.__H.__.filter(function(v){return!!v.__c});if(g.every(function(v){return!v.__N}))return!s||s.call(this,u,p,c);var l=n.__c.props!==u;return g.forEach(function(v){if(v.__N){var _=v.__[0];v.__=v.__N,v.__N=void 0,_!==v.__[0]&&(l=!0)}}),s&&s.call(this,u,p,c)||l};I.__f=!0;var s=I.shouldComponentUpdate,r=I.componentWillUpdate;I.componentWillUpdate=function(u,p,c){if(this.__e){var g=s;s=void 0,a(u,p,c),s=g}r&&r.call(this,u,p,c)},I.shouldComponentUpdate=a}return n.__N||n.__}function gt(t,e){var i=He(ne++,3);!P.__s&&vt(i.__H,e)&&(i.__=t,i.u=e,I.__H.__h.push(i))}function Q(t){return pe=5,mt(function(){return{current:t}},[])}function mt(t,e){var i=He(ne++,7);return vt(i.__H,e)&&(i.__=t(),i.__H=e,i.__h=t),i.__}function jt(){for(var t;t=_t.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(he),t.__H.__h.forEach(Ee),t.__H.__h=[]}catch(e){t.__H.__h=[],P.__e(e,t.__v)}}P.__b=function(t){I=null,We&&We(t)},P.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Ze&&Ze(t,e)},P.__r=function(t){qe&&qe(t),ne=0;var e=(I=t.__c).__H;e&&(be===I?(e.__h=[],I.__h=[],e.__.forEach(function(i){i.__N&&(i.__=i.__N),i.u=i.__N=void 0})):(e.__h.forEach(he),e.__h.forEach(Ee),e.__h=[],ne=0)),be=I},P.diffed=function(t){Ve&&Ve(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(_t.push(e)!==1&&Fe===P.requestAnimationFrame||((Fe=P.requestAnimationFrame)||zt)(jt)),e.__H.__.forEach(function(i){i.u&&(i.__H=i.u),i.u=void 0})),be=I=null},P.__c=function(t,e){e.some(function(i){try{i.__h.forEach(he),i.__h=i.__h.filter(function(n){return!n.__||Ee(n)})}catch(n){e.some(function(a){a.__h&&(a.__h=[])}),e=[],P.__e(n,i.__v)}}),Ge&&Ge(t,e)},P.unmount=function(t){Je&&Je(t);var e,i=t.__c;i&&i.__H&&(i.__H.__.forEach(function(n){try{he(n)}catch(a){e=a}}),i.__H=void 0,e&&P.__e(e,i.__v))};var Ke=typeof requestAnimationFrame=="function";function zt(t){var e,i=function(){clearTimeout(n),Ke&&cancelAnimationFrame(e),setTimeout(t)},n=setTimeout(i,35);Ke&&(e=requestAnimationFrame(i))}function he(t){var e=I,i=t.__c;typeof i=="function"&&(t.__c=void 0,i()),I=e}function Ee(t){var e=I;t.__c=t.__(),I=e}function vt(t,e){return!t||t.length!==e.length||e.some(function(i,n){return i!==t[n]})}function yt(t,e){return typeof e=="function"?e(t):e}var Bt=Symbol.for("preact-signals");function xe(){if(X>1)X--;else{for(var t,e=!1;te!==void 0;){var i=te;for(te=void 0,Ce++;i!==void 0;){var n=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&bt(i))try{i.c()}catch(a){e||(t=a,e=!0)}i=n}}if(Ce=0,X--,e)throw t}}function Ye(t){if(X>0)return t();X++;try{return t()}finally{xe()}}var k=void 0;function xt(t){var e=k;k=void 0;try{return t()}finally{k=e}}var te=void 0,X=0,Ce=0,fe=0;function kt(t){if(k!==void 0){var e=t.n;if(e===void 0||e.t!==k)return e={i:0,S:t,p:k.s,n:void 0,t:k,e:void 0,x:void 0,r:e},k.s!==void 0&&(k.s.n=e),k.s=e,t.n=e,32&k.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=k.s,e.n=void 0,k.s.n=e,k.s=e),e}}function E(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}E.prototype.brand=Bt;E.prototype.h=function(){return!0};E.prototype.S=function(t){var e=this,i=this.t;i!==t&&t.e===void 0&&(t.x=i,this.t=t,i!==void 0?i.e=t:xt(function(){var n;(n=e.W)==null||n.call(e)}))};E.prototype.U=function(t){var e=this;if(this.t!==void 0){var i=t.e,n=t.x;i!==void 0&&(i.x=n,t.e=void 0),n!==void 0&&(n.e=i,t.x=void 0),t===this.t&&(this.t=n,n===void 0&&xt(function(){var a;(a=e.Z)==null||a.call(e)}))}};E.prototype.subscribe=function(t){var e=this;return ae(function(){var i=e.value,n=k;k=void 0;try{t(i)}finally{k=n}},{name:"sub"})};E.prototype.valueOf=function(){return this.value};E.prototype.toString=function(){return this.value+""};E.prototype.toJSON=function(){return this.value};E.prototype.peek=function(){var t=k;k=void 0;try{return this.value}finally{k=t}};Object.defineProperty(E.prototype,"value",{get:function(){var t=kt(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(Ce>100)throw new Error("Cycle detected");this.v=t,this.i++,fe++,X++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{xe()}}}});function U(t,e){return new E(t,e)}function bt(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function wt(t){for(var e=t.s;e!==void 0;e=e.n){var i=e.S.n;if(i!==void 0&&(e.r=i),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function St(t){for(var e=t.s,i=void 0;e!==void 0;){var n=e.p;e.i===-1?(e.S.U(e),n!==void 0&&(n.n=e.n),e.n!==void 0&&(e.n.p=n)):i=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=n}t.s=i}function z(t,e){E.call(this,void 0),this.x=t,this.s=void 0,this.g=fe-1,this.f=4,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}z.prototype=new E;z.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===fe))return!0;if(this.g=fe,this.f|=1,this.i>0&&!bt(this))return this.f&=-2,!0;var t=k;try{wt(this),k=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(i){this.v=i,this.f|=16,this.i++}return k=t,St(this),this.f&=-2,!0};z.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}E.prototype.S.call(this,t)};z.prototype.U=function(t){if(this.t!==void 0&&(E.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};z.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};Object.defineProperty(z.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=kt(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Qe(t,e){return new z(t,e)}function $t(t){var e=t.u;if(t.u=void 0,typeof e=="function"){X++;var i=k;k=void 0;try{e()}catch(n){throw t.f&=-2,t.f|=8,Xe(t),n}finally{k=i,xe()}}}function Xe(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,$t(t)}function Dt(t){if(k!==this)throw new Error("Out-of-order effect");St(this),k=t,this.f&=-2,8&this.f&&Xe(this),xe()}function q(t,e){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=e?.name}q.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}};q.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,$t(this),wt(this),X++;var t=k;return k=this,Dt.bind(this,t)};q.prototype.N=function(){2&this.f||(this.f|=2,this.o=te,te=this)};q.prototype.d=function(){this.f|=8,1&this.f||Xe(this)};q.prototype.dispose=function(){this.d()};function ae(t,e){var i=new q(t,e);try{i.c()}catch(a){throw i.d(),a}var n=i.d.bind(i);return n[Symbol.dispose]=n,n}var Tt,we,It=[];ae(function(){Tt=this.N})();function V(t,e){b[t]=e.bind(null,b[t]||function(){})}function _e(t){we&&we(),we=t&&t.S()}function Rt(t){var e=this,i=t.data,n=Wt(i);n.value=i;var a=mt(function(){for(var u=e,p=e.__v;p=p.__;)if(p.__c){p.__c.__$f|=4;break}var c=Qe(function(){var _=n.value.value;return _===0?0:_===!0?"":_||""}),g=Qe(function(){return!Array.isArray(c.value)&&!st(c.value)}),l=ae(function(){if(this.N=Pt,g.value){var _=c.value;u.__v&&u.__v.__e&&u.__v.__e.nodeType===3&&(u.__v.__e.data=_)}}),v=e.__$u.d;return e.__$u.d=function(){l(),v.call(this)},[g,c]},[]),s=a[0],r=a[1];return s.value?r.peek():r.value}Rt.displayName="ReactiveTextNode";Object.defineProperties(E.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Rt},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});V("__b",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),typeof e.type=="string"){var i,n=e.props;for(var a in n)if(a!=="children"){var s=n[a];s instanceof E&&(i||(e.__np=i={}),i[a]=s,n[a]=s.peek())}}t(e)});V("__r",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(e.type.displayName||e.type.name||"Unknown"),e.type!==se){_e();var i,n=e.__c;n&&(n.__$f&=-2,(i=n.__$u)===void 0&&(n.__$u=i=(function(a){var s;return ae(function(){s=this}),s.c=function(){n.__$f|=1,n.setState({})},s})())),_e(i)}t(e)});V("__e",function(t,e,i,n){typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),_e(),t(e,i,n)});V("diffed",function(t,e){typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),_e();var i;if(typeof e.type=="string"&&(i=e.__e)){var n=e.__np,a=e.props;if(n){var s=i.U;if(s)for(var r in s){var u=s[r];u!==void 0&&!(r in n)&&(u.d(),s[r]=void 0)}else s={},i.U=s;for(var p in n){var c=s[p],g=n[p];c===void 0?(c=Ft(i,p,g,a),s[p]=c):c.o(g,a)}}}t(e)});function Ft(t,e,i,n){var a=e in t&&t.ownerSVGElement===void 0,s=U(i);return{o:function(r,u){s.value=r,n=u},d:ae(function(){this.N=Pt;var r=s.value.value;n[e]!==r&&(n[e]=r,a?t[e]=r:r?t.setAttribute(e,r):t.removeAttribute(e))})}}V("unmount",function(t,e){if(typeof e.type=="string"){var i=e.__e;if(i){var n=i.U;if(n){i.U=void 0;for(var a in n){var s=n[a];s&&s.d()}}}}else{var r=e.__c;if(r){var u=r.__$u;u&&(r.__$u=void 0,u.d())}}t(e)});V("__h",function(t,e,i,n){(n<3||n===9)&&(e.__$f|=2),t(e,i,n)});ee.prototype.shouldComponentUpdate=function(t,e){var i=this.__$u,n=i&&i.s!==void 0;for(var a in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var s=2&this.__$f;if(!(n||s||4&this.__$f)||1&this.__$f)return!0}else if(!(n||4&this.__$f)||3&this.__$f)return!0;for(var r in t)if(r!=="__source"&&t[r]!==this.props[r])return!0;for(var u in this.props)if(!(u in t))return!0;return!1};function Wt(t,e){return Xt(function(){return U(t,e)})[0]}var qt=function(t){queueMicrotask(function(){queueMicrotask(t)})};function Vt(){Ye(function(){for(var t;t=It.shift();)Tt.call(t)})}function Pt(){It.push(this)===1&&(b.requestAnimationFrame||qt)(Vt)}let Se=null,S=null;const D=[];async function et(){Se===null&&(Se=await(await fetch("/api/drivers/nhentai/latest")).json());const t=Math.round(Math.random()*Se),e=await(await fetch(`/api/drivers/nhentai/pages/${t}`)).json(),i=Math.floor(Math.random()*e.length),n=e[i].split("/");return{id:t.toString(),page:i+1,url:`/resource/nhentai/${n.slice(4,6).join("/")}`,source:`${t}/${i+1}`}}const Gt={id:"nhentai",name:"nHentai",async next(t){const e=t.split("/").map(i=>i.trim()).filter(i=>i.length>0);if(e.length>0){if(S===null||e[0]!==S.id)S={id:e[0],pages:(await(await fetch(`/api/drivers/nhentai/pages/${e[0]}`)).json()).map(i=>`/resource/nhentai/${i.split("/").slice(4,6).join("/")}`),index:e.length>1?parseInt(e[1])-1:0,cacheIndex:e.length>1?parseInt(e[1])-1:0};else{const i=isNaN(parseInt(e[1]))?1:parseInt(e[1])-1;S.index=i===S.index?S.index+1:i}return S.index>=S.pages.length?(S=null,await this.next("")):{id:S.id,page:S.index+1,url:S.pages[S.index],source:`${S.id}/${S.index+1}`}}return D.length>0?Object.assign(D.splice(0,1)[0],{source:""}):Object.assign(await et(),{source:""})},async preload(t){if(S===null){if(D.length<t){const e=D[D.push(await et())-1];return{id:e.id,page:e.page,url:e.url,amount:D.length}}}else if(S.cacheIndex<Math.min(S.index+t,S.pages.length))return S.cacheIndex++,{id:S.id,page:S.cacheIndex,url:S.pages[S.cacheIndex-1],amount:S.cacheIndex-S.index}}},Jt=Object.freeze(Object.defineProperty({__proto__:null,default:Gt},Symbol.toStringTag,{value:"Module"}));let $=null;const F=[];async function tt(){const t=(await(await fetch("/api/drivers/pixiv/discovery")).json()).body.illusts,e=t[Math.floor(Math.random()*t.length)],i=(await(await fetch(`/api/drivers/pixiv/pages/${e.id}`)).json()).body,n=Math.floor(Math.random()*e.pageCount),a=i[n].urls.original.split("/");return{id:`${e.id}`,page:n+1,url:`/resource/pixiv/${a.slice(5,11).join("-")}/${a[11]}`,source:`${e.id}/${n+1}`}}const Zt={id:"pixiv",name:"Pixiv",async next(t){const e=t.split("/").map(i=>i.trim()).filter(i=>i.length>0);if(e.length>0){if($===null||e[0]!==$.id)$={id:e[0],pages:(await(await fetch(`/api/drivers/pixiv/pages/${e[0]}`)).json()).body.map(i=>{const n=i.urls.original.split("/");return`/resource/pixiv/${n.slice(5,11).join("-")}/${n[11]}`}),index:e.length>1?parseInt(e[1])-1:0,cacheIndex:e.length>1?parseInt(e[1])-1:0};else{const i=isNaN(parseInt(e[1]))?1:parseInt(e[1])-1;$.index=i===$.index?$.index+1:i}return $.index>=$.pages.length?($=null,await this.next("")):{id:$.id,page:$.index+1,url:$.pages[$.index],source:`${$.id}/${$.index+1}`}}return F.length>0?Object.assign(F.splice(0,1)[0],{source:""}):Object.assign(await tt(),{source:""})},preload:async t=>{if($===null){if(F.length<t){const e=F[F.push(await tt())-1];return{id:e.id,page:e.page,url:e.url,amount:F.length}}}else if($.cacheIndex<Math.min($.index+t,$.pages.length))return $.cacheIndex++,{id:$.id,page:$.cacheIndex,url:$.pages[$.cacheIndex-1],amount:$.cacheIndex-$.index};return null}},Kt=Object.freeze(Object.defineProperty({__proto__:null,default:Zt},Symbol.toStringTag,{value:"Module"})),it=Object.assign({"./drivers/nhentai.ts":Jt,"./drivers/pixiv.ts":Kt});class f{static canvas=document.createElement("canvas");static ctx=this.canvas.getContext("2d");static submitCanvas=document.createElement("canvas");static submitCtx=this.submitCanvas.getContext("2d");static drivers={pixiv:it["./drivers/pixiv.ts"].default,nhentai:it["./drivers/nhentai.ts"].default};static data=null;static timestamp=0;static async next(e){const i=this.data,n=performance.now();this.data=null,this.timestamp=performance.now();try{const a=e===void 0?h.source.driver:e.driver,s=await this.drivers[a].next(e===void 0?h.source.value:`${e.id}/${e.page}`);if(s===null)this.data=i;else{h.updateSource({value:s.source,display:`${s.id}/${s.page}`});const r=document.createElement("img");r.src=s.url,r.addEventListener("load",()=>{this.timestamp===n&&(this.data={provider:a,id:s.id,page:s.page,element:r,transform:this.calculateTransform(r.width,r.height),strokes:[]},this.canvas.width=r.width,this.canvas.height=r.height)})}}catch{this.data=i}}static async submit(){if(this.data!==null){const e=this.data;this.data=null,m.reset(),d.reset();const i=this.submitCanvas,n=this.submitCtx;i.width=e.element.width,i.height=e.element.height,n.fillStyle="white",n.strokeStyle="white";for(const r of e.strokes)if(r.type===1||r.type===2)n.lineCap=r.type===1?"butt":"round",n.lineWidth=(e.element.width+e.element.height)*(r.size*.0025),n.moveTo(r.x1,r.y1),n.lineTo(r.x2,r.y2),n.stroke(),n.beginPath();else if(r.type===3){for(const[u,p]of r.points.entries())u===0?n.moveTo(p.x,p.y):n.lineTo(p.x,p.y);n.lineTo(r.points[0].x,r.points[0].y),n.fill(),n.beginPath()}const a=i.toDataURL("image/png",1).substring(22);n.clearRect(0,0,i.width,i.height),n.imageSmoothingEnabled=!1,n.drawImage(e.element,0,0,i.width,i.height);const s=i.toDataURL("image/jpeg",1).substring(23);try{await fetch("/api/submit",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e.provider,id:e.id,page:e.page,image:s,mask:a,author:h.settings.username})}),await this.next()}catch{this.data=e}}}static update(){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.imageSmoothingEnabled=!1,this.data!==null){this.ctx.fillStyle=`rgba(0,255,0,${d.strokeOpacity})`,this.ctx.strokeStyle=`rgba(0,255,0,${d.strokeOpacity})`;for(const e of this.data.strokes)if(e.type===1||e.type===2)this.ctx.lineCap=e.type===1?"butt":"round",this.ctx.lineWidth=(this.data.element.width+this.data.element.height)*(e.size*.0025),this.ctx.moveTo(e.x1,e.y1),this.ctx.lineTo(e.x2,e.y2),this.ctx.stroke(),this.ctx.beginPath();else if(e.type===3){for(const[i,n]of e.points.entries())i===0?this.ctx.moveTo(n.x,n.y):this.ctx.lineTo(n.x,n.y);this.ctx.lineTo(e.points[0].x,e.points[0].y),this.ctx.fill(),this.ctx.beginPath()}if(this.ctx.fillStyle="rgba(0,255,0,0.5)",this.ctx.strokeStyle="rgba(0,255,0,0.5)",d.strokeType===1||d.strokeType===2)d.startX!==null&&d.startY!==null&&(this.ctx.lineCap=d.strokeType===1?"butt":"round",this.ctx.lineWidth=(this.data.element.width+this.data.element.height)*(d.strokeSize*.0025),this.ctx.moveTo(d.startX,d.startY),this.ctx.lineTo(d.mouse.imageX,d.mouse.imageY),this.ctx.stroke(),this.ctx.beginPath());else if(d.strokeType===3){for(const[e,i]of d.strokePoints.entries())e===0?this.ctx.moveTo(i.x,i.y):this.ctx.lineTo(i.x,i.y);d.strokePoints.length>2&&this.ctx.lineTo(d.strokePoints[0].x,d.strokePoints[0].y),this.ctx.fill(),this.ctx.beginPath()}}}static async preload(){return await f.drivers[h.source.driver].preload(h.settings.preload)}static updateTransform(){this.data!==null&&(this.data.transform=this.calculateTransform(this.data.element.width,this.data.element.height))}static calculateTransform(e,i){const n=m.canvas.width/m.canvas.height,a=e/i;let s,r;a>n?(s=m.canvas.width,r=m.canvas.width/a):(s=m.canvas.height*a,r=m.canvas.height);const u=3.5*parseFloat(getComputedStyle(document.documentElement).fontSize)*h.settings.resolution;return s*=.9,r*=.9,r-=u/2,{x:(m.canvas.width-s)/2,y:(m.canvas.height+u-r)/2,width:s,height:r,widthScale:s/e,heightScale:r/i}}}function Et(t,e){return localStorage.hasOwnProperty(t)?JSON.parse(localStorage.getItem(t)):e}const ce=U({help:!1,settings:!1,entries:!1}),Z=U(Et("settings",{username:"unknown",fps:0,resolution:window.devicePixelRatio,preload:5,moveSpeed:1,scaleSpeed:1,reduceTransparency:!1})),K=U(Et("source",{driver:Object.keys(f.drivers)[0],value:"",display:""}));class h{static get layout(){return ce.value}static get settings(){return Z.value}static get source(){return K.value}static get layoutSignal(){return ce}static get settingsSignal(){return Z}static get sourceSignal(){return K}static updateLayout(e){ce.value={...ce.value,...e}}static updateSettings(e){Z.value={...Z.value,...e},localStorage.setItem("settings",JSON.stringify(Z.value))}static updateSource(e){K.value={...K.value,...e},localStorage.setItem("source",JSON.stringify(K.value))}}class d{static mouse={button:{left:0,right:0},editorX:0,editorY:0,imageX:0,imageY:0,oldImageX:0,oldImageY:0};static keyboard=new Map;static strokeType=1;static strokeSize=2;static strokePoints=[];static startX=null;static startY=null;static moveIndex=null;static strokeOpacity=1;static saveConfirm=0;static reset(){this.strokePoints=[],this.startX=null,this.startY=null,this.moveIndex=null}static update(e){if(f.data!==null)if(d.mouse.oldImageX=this.mouse.imageX,d.mouse.oldImageY=this.mouse.imageY,d.mouse.imageX=(this.mouse.editorX/m.camera.scale+(m.camera.x-f.data.transform.x))/f.data.transform.widthScale,d.mouse.imageY=(this.mouse.editorY/m.camera.scale+(m.camera.y-f.data.transform.y))/f.data.transform.heightScale,this.mouse.button.left===1){if(this.strokeType==1||this.strokeType===2)this.startX=this.mouse.imageX,this.startY=this.mouse.imageY;else if(this.strokeType===3){for(let i=0;i<this.strokePoints.length;i++){const n=(f.data.transform.x+d.strokePoints[i].x*f.data.transform.widthScale-m.camera.x)*m.camera.scale,a=(f.data.transform.y+d.strokePoints[i].y*f.data.transform.heightScale-m.camera.y)*m.camera.scale;if(Math.hypot(n-this.mouse.editorX,a-this.mouse.editorY)<7.5*h.settings.resolution){this.moveIndex=i;break}}this.moveIndex===null&&this.strokePoints.push({x:this.mouse.imageX,y:this.mouse.imageY})}}else if(this.mouse.button.right===1){if(this.strokeType===1||this.strokeType===2){const i=f.data.strokes[f.data.strokes.length-1];i!==void 0&&i.type===this.strokeType&&(this.startX=i.x2,this.startY=i.y2)}else if(this.strokeType===3)if(this.strokePoints.length===0){const i=f.data.strokes[f.data.strokes.length-1];i!==void 0&&i.type===3&&(this.strokePoints=i.points,f.data.strokes.splice(f.data.strokes.length-1,1))}else this.strokePoints.length>2&&f.data.strokes.push({type:3,points:this.strokePoints}),this.strokePoints=[]}else this.mouse.button.left===2?this.moveIndex!==null&&(this.strokePoints[this.moveIndex]={x:this.mouse.imageX,y:this.mouse.imageY}):(this.mouse.button.left===3||this.mouse.button.right===3)&&((this.strokeType===1||this.strokeType===2)&&this.startX!==null&&this.startY!==null?(f.data.strokes.push({type:this.strokeType,size:this.strokeSize,x1:this.startX,y1:this.startY,x2:this.mouse.imageX,y2:this.mouse.imageY}),this.startX=null,this.startY=null):this.strokeType===3&&(this.moveIndex=null));this.keyboard.get("Escape")===1?this.reset():this.keyboard.get("1")===1?(this.strokeType=1,this.strokePoints=[]):this.keyboard.get("2")===1?(this.strokeType=2,this.strokePoints=[]):this.keyboard.get("3")===1&&(this.strokeType=3,this.startX=null,this.startY=null),this.keyboard.get("-")===1?(d.strokeSize-=1,d.strokeSize=Math.min(100/m.camera.scale,Math.max(.5/m.camera.scale,d.strokeSize))):this.keyboard.get("=")===1&&(d.strokeSize+=1,d.strokeSize=Math.min(100/m.camera.scale,Math.max(.5/m.camera.scale,d.strokeSize))),this.keyboard.has("a")?m.camera.xSpeed=-3*h.settings.moveSpeed:this.keyboard.has("d")&&(m.camera.xSpeed=3*h.settings.moveSpeed),this.keyboard.has("w")?m.camera.ySpeed=-3*h.settings.moveSpeed:this.keyboard.has("s")&&(m.camera.ySpeed=3*h.settings.moveSpeed),this.keyboard.has("q")?m.camera.scaleSpeed=-.005*h.settings.scaleSpeed:this.keyboard.has("e")&&(m.camera.scaleSpeed=.005*h.settings.scaleSpeed),this.keyboard.get("r")===1?m.reset():this.keyboard.get("f")===1&&(this.strokeOpacity-=.5,this.strokeOpacity<0&&(this.strokeOpacity=1)),this.keyboard.get("z")===1?f.next():this.keyboard.get("x")===1&&(this.strokePoints.length>0?this.strokePoints.splice(this.strokePoints.length-1):f.data!==null&&f.data.strokes.length>0&&f.data.strokes.splice(f.data.strokes.length-1)),f.data!==null&&(this.keyboard.has("c")?(this.saveConfirm+=.003*e,this.saveConfirm>1&&(f.submit(),this.saveConfirm=0)):this.saveConfirm=0),this.mouse.button.left===1?this.mouse.button.left=2:this.mouse.button.left===3&&(this.mouse.button.left=0),this.mouse.button.right===1?this.mouse.button.right=2:this.mouse.button.right===3&&(this.mouse.button.right=0),this.keyboard.forEach((i,n)=>{this.keyboard.set(n,2)})}}window.addEventListener("mousedown",t=>{t.target===m.canvas&&(t.button===0?d.mouse.button.left=1:t.button===2&&(d.mouse.button.right=1))});window.addEventListener("mouseup",t=>{t.button===0?d.mouse.button.left=3:t.button===2&&(d.mouse.button.right=3)});window.addEventListener("mousemove",t=>{d.mouse.editorX=t.x*h.settings.resolution,d.mouse.editorY=t.y*h.settings.resolution});window.addEventListener("wheel",t=>{t.target===m.canvas&&(d.strokeSize+=-t.deltaY/(10*m.camera.scale),d.strokeSize=Math.min(100/m.camera.scale,Math.max(.5/m.camera.scale,d.strokeSize)))});window.addEventListener("keydown",t=>{t.target===document.body&&(d.keyboard.has(t.key)||d.keyboard.set(t.key,1))});window.addEventListener("keyup",t=>{d.keyboard.delete(t.key)});let $e=0;function Qt(){if(Math.hypot(d.mouse.imageX-d.mouse.oldImageX,d.mouse.imageY-d.mouse.oldImageY)>.1){let e=Math.atan2(d.mouse.imageY-d.mouse.oldImageY,d.mouse.imageX-d.mouse.oldImageX)-$e;for(;e<-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;$e+=e*.25}return $e}class m{static canvas=document.getElementById("canvas-main");static ctx=this.canvas.getContext("2d");static camera={x:0,xSpeed:0,y:0,ySpeed:0,scale:1,scaleSpeed:0};static resize(){const e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*h.settings.resolution,this.canvas.height=e.height*h.settings.resolution,f.updateTransform(),h.settings.fps!==0&&this.update(0)}static reset(){this.camera={x:0,xSpeed:0,y:0,ySpeed:0,scale:1,scaleSpeed:0}}static update(e){const i=this.camera.x,n=this.camera.y,a=this.camera.scale;this.camera.scale*=1+this.camera.scaleSpeed*e,this.camera.scale=Math.min(500,this.camera.scale);const s=i+d.mouse.editorX/a,r=n+d.mouse.editorY/a,u=this.camera.scale/a;if(this.camera.x=s+(i-s)/u,this.camera.y=r+(n-r)/u,this.camera.x+=this.camera.xSpeed*e/this.camera.scale*h.settings.resolution,this.camera.y+=this.camera.ySpeed*e/this.camera.scale*h.settings.resolution,this.camera.xSpeed*=Math.pow(.99,e),this.camera.ySpeed*=Math.pow(.99,e),this.camera.scaleSpeed*=Math.pow(.99,e),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.imageSmoothingEnabled=!1,f.data!==null){const p=f.data.transform;if(this.ctx.drawImage(f.data.element,(p.x-this.camera.x)*this.camera.scale,(p.y-this.camera.y)*this.camera.scale,p.width*this.camera.scale,p.height*this.camera.scale),f.update(),this.ctx.drawImage(f.canvas,(p.x-this.camera.x)*this.camera.scale,(p.y-this.camera.y)*this.camera.scale,p.width*this.camera.scale,p.height*this.camera.scale),this.ctx.fillStyle="rgba(255,0,0,0.5)",this.ctx.strokeStyle="rgba(255,0,0,0.5)",d.strokeType===1&&d.startX===null&&d.startY===null){const c=Qt()+Math.PI/2,g=(f.data.transform.width+f.data.transform.height)*(d.strokeSize/2*.0025)*m.camera.scale,l=d.mouse.editorX+g*Math.cos(c),v=d.mouse.editorY+g*Math.sin(c),_=d.mouse.editorX+g*Math.cos(c+Math.PI),T=d.mouse.editorY+g*Math.sin(c+Math.PI);this.ctx.lineCap="butt",this.ctx.lineWidth=d.strokeSize*.25*m.camera.scale,this.ctx.moveTo(l,v),this.ctx.lineTo(_,T),this.ctx.stroke(),this.ctx.beginPath()}else if(d.strokeType===2&&d.startX===null&&d.startY===null)this.ctx.arc(d.mouse.editorX,d.mouse.editorY,(f.data.transform.width+f.data.transform.height)*(d.strokeSize/2*.0025)*this.camera.scale,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath();else if(d.strokeType===3)for(const c of d.strokePoints)this.ctx.arc((f.data.transform.x+c.x*f.data.transform.widthScale-this.camera.x)*this.camera.scale,(f.data.transform.y+c.y*f.data.transform.heightScale-this.camera.y)*this.camera.scale,5*h.settings.resolution,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath();d.saveConfirm>0&&(this.ctx.fillStyle=`rgba(255,255,255,${d.saveConfirm})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))}}}window.addEventListener("load",()=>{m.resize(),window.addEventListener("resize",()=>m.resize())});m.canvas.addEventListener("contextmenu",t=>{t.preventDefault()});m.canvas.addEventListener("click",()=>{h.updateLayout({help:!1,settings:!1,entries:!1})});const ei=()=>{const t=i=>{const n=i.substring(0,20).toLowerCase().split("");for(let a=n.length-1;a>=0;a--)"abcdefghijklmnopqrstuvwxyz0123456789".includes(n[a])||n.splice(a,1);n.length>=5&&h.updateSettings({username:n.slice(0,16).join("")})},e=i=>{m.camera.x/=h.settings.resolution,m.camera.y/=h.settings.resolution,h.updateSettings({resolution:i}),m.camera.x*=h.settings.resolution,m.camera.y*=h.settings.resolution,m.resize()};return o("div",{class:"shadow",style:{display:h.layout.settings?"block":"none",border:"0.05rem solid ",borderRadius:"0.5rem",marginRight:"var(--spacing-medium)",marginBottom:"var(--spacing-medium)",overflow:"hidden"},children:[o("h3",{class:h.settings.reduceTransparency?"container-solid-light":"container-glassy-light",style:{padding:"var(--spacing-medium)"},children:"Settings"}),o("div",{class:h.settings.reduceTransparency?"container-solid-dark":"container-glassy-dark",children:[o("div",{style:{width:"100%",height:"0.05rem",backgroundColor:"var(--color-foreground)",opacity:.1}}),o("div",{style:{padding:"var(--spacing-medium)"},children:[o("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[o("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Username:"}),o("input",{value:h.settings.username,onChange:i=>t(i.target.value)})]}),o("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[o("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"FPS:"}),o("input",{type:"range",step:"10",min:"0",max:"120",value:h.settings.fps,onInput:i=>h.updateSettings({fps:parseInt(i.target.value)}),style:{marginRight:"var(--spacing-small)"}}),o("p",{children:h.settings.fps===0?"(VSync)":`(${h.settings.fps})`})]}),o("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[o("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Resolution:"}),o("input",{type:"range",step:"0.1",min:"0.5",max:"2",value:h.settings.resolution,onInput:i=>e(parseFloat(i.target.value)),style:{marginRight:"var(--spacing-small)"}}),o("p",{children:h.settings.resolution===window.devicePixelRatio?"(Native)":`(${h.settings.resolution}x)`})]}),o("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[o("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Preload Image:"}),o("input",{type:"range",step:"1",min:"0",max:"10",value:h.settings.preload,onInput:i=>h.updateSettings({preload:parseInt(i.target.value)}),style:{marginRight:"var(--spacing-small)"}}),o("p",{children:h.settings.preload===5?"(Default)":`(${h.settings.preload})`})]}),o("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[o("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Move Speed:"}),o("input",{type:"range",step:"0.1",min:"0.5",max:"1.5",value:h.settings.moveSpeed,onInput:i=>h.updateSettings({moveSpeed:parseFloat(i.target.value)}),style:{marginRight:"var(--spacing-small)"}}),o("p",{children:h.settings.moveSpeed===1?"(Default)":`(${h.settings.moveSpeed}x)`})]}),o("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[o("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Scale Speed:"}),o("input",{type:"range",step:"0.1",min:"0.5",max:"1.5",value:h.settings.scaleSpeed,onInput:i=>h.updateSettings({scaleSpeed:parseFloat(i.target.value)}),style:{marginRight:"var(--spacing-small)"}}),o("p",{children:h.settings.scaleSpeed===1?"(Default)":`(${h.settings.scaleSpeed}x)`})]}),o("div",{style:{display:"flex",alignItems:"center"},children:[o("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Reduce Transparency:"}),o("input",{type:"checkbox",checked:h.settings.reduceTransparency,onChange:i=>h.updateSettings({reduceTransparency:i.target.checked})})]})]})]})]})},y=U(null),L=U({provider:"all",author:"all"}),O=U({top:0,bottom:0});class M{static loading=0;static async loadEntries(){const e=await(await fetch("/api/list")).json(),i=[],n=[];for(const a of e){const s=a.split("-");i.includes(s[0])||i.push(s[0]),n.includes(s[3])||n.push(s[3])}y.value={entries:e,filtered:[],providers:i,authors:n},this.updateFilter({})}static filterEntries(){if(y.value!==null){const e=[];for(const i of y.value.entries){const n=i.split("-");(L.value.provider==="all"||n[0]===L.value.provider)&&(L.value.author==="all"||n[3]===L.value.author)&&e.push(i)}y.value={entries:y.value.entries,filtered:e,providers:y.value.providers,authors:y.value.authors}}Ye(()=>{O.value={top:0,bottom:0},this.loadBottom(10,20)})}static updateFilter(e){L.value=Object.assign(L.value,e),y.value!==null&&(L.value.provider!=="all"&&!y.value.providers.includes(L.value.provider)&&(L.value.provider=y.value.providers.length>0?y.value.providers[0]:"all"),L.value.author!=="all"&&!y.value.authors.includes(L.value.author)&&(L.value.author=y.value.authors.length>0?y.value.authors[0]:"all")),this.filterEntries()}static loadTop(e,i){if(y.value!==null){let n=O.value.top,a=O.value.bottom;if(Math.abs(n-a)>i)for(let s=0;s<e;s++)a--;for(let s=0;s<e&&n>0;s++)n--;O.value={top:n,bottom:a}}}static loadBottom(e,i){if(y.value!==null){let n=O.value.top,a=O.value.bottom;if(Math.abs(n-a)>i)for(let s=0;s<e;s++)n++;for(let s=0;s<e&&a<y.value.filtered.length;s++)a++;O.value={top:n,bottom:a}}}}const ti=t=>{const e=Q(null),i=Q(null),n=Q(!1),a=Q(!1),s=()=>{n.current||(n.current=!0,M.loading--)},r=()=>{a.current||(a.current=!0,M.loading--)},u=()=>{f.drivers.hasOwnProperty(c[0])&&(f.next({driver:c[0],id:c[1],page:c[2]}),h.updateLayout({help:!1,settings:!1,entries:!1}))},p=async()=>{if(y.value!==null){await fetch(`/api/remove/${t}`,{method:"DELETE"});const g=y.value.entries.indexOf(t),l=[...y.value.entries.slice(0,g),...y.value.entries.slice(g+1)],v=y.value.filtered.indexOf(t),_=[...y.value.filtered.slice(0,v),...y.value.filtered.slice(v+1)],T=[],C=[];for(const R of l){const x=R.split("-");T.includes(x[0])||T.push(x[0]),C.includes(x[3])||C.push(x[3])}Ye(()=>{y.value={entries:l,filtered:_,providers:T,authors:C},O.value={top:Math.min(l.length-1,O.value.top),bottom:Math.min(l.length-1,O.value.bottom)}})}};gt(()=>(M.loading+=2,i.current.addEventListener("click",()=>{i.current.style.opacity=i.current.style.opacity==="1"?"0":"1"}),()=>{M.loading-=n.current?0:1,M.loading-=a.current?0:1}),[]);const c=t.split("-");return o("div",{children:[o("div",{style:{position:"relative",width:"100%",marginBottom:"-0.25rem",userSelect:"none"},children:[o("img",{ref:e,src:`/resource/image/${t}`,onLoad:s,style:{borderRadius:"0.25rem 0.25rem 0rem 0rem",width:"100%"}}),o("img",{ref:i,src:`/resource/mask/${t}`,onLoad:r,style:{position:"absolute",borderRadius:"0.25rem 0.25rem 0rem 0rem",left:"0rem",top:"0rem",width:"100%",filter:"invert(46%) sepia(88%) saturate(3060%) hue-rotate(87deg) brightness(126%) contrast(119%)",cursor:"pointer"}})]}),o("div",{style:{display:"flex",backgroundColor:"var(--color-container-light)",borderRadius:"0rem 0rem 0.25rem 0.25rem",padding:"var(--spacing-small)"},children:[o("h5",{style:{marginRight:"var(--spacing-small)"},children:[f.drivers.hasOwnProperty(c[0])?f.drivers[c[0]].name:c[0],":"]}),o("p",{style:{flex:1,marginRight:"var(--spacing-small)"},children:[c[1],"/",c[2]]}),o("button",{onClick:p,style:{marginRight:"var(--spacing-small)",cursor:"pointer"},children:"Remove"}),o("button",{onClick:u,style:{cursor:"pointer"},children:"Edit"})]})]},t)},ii=()=>{const t=Q(null);return gt(()=>{if(t.current!==null){const e=setInterval(()=>{y.value!==null&&M.loading===0&&(t.current.scrollTop<window.innerHeight/5?M.loadTop(10,20):Math.round(t.current.scrollTop+t.current.clientHeight)>=t.current.scrollHeight-window.innerHeight/5&&M.loadBottom(10,20))},100);return()=>{clearInterval(e)}}}),o("div",{class:"shadow",style:{display:h.layout.entries?"flex":"none",flexDirection:"column",border:"0.05rem solid ",borderRadius:"0.5rem",width:"50rem",maxWidth:"calc(100dvw - calc(var(--spacing-medium) * 2))",maxHeight:"calc(100dvh - calc(3.5rem + calc(var(--spacing-medium) * 2)))",overflow:"hidden"},children:[o("div",{class:h.settings.reduceTransparency?"container-solid-light":"container-glassy-light",style:{display:"flex",padding:"var(--spacing-medium)"},children:[o("div",{style:{flex:1,display:"flex",alignItems:"center",marginRight:"var(--spacing-medium)"},children:[o("h3",{children:"Entries"}),y.value===null?void 0:o("p",{style:{marginLeft:"var(--spacing-small)",opacity:.5},children:["(Found ",y.value.filtered.length,")"]})]}),y.value===null?o("select",{disabled:!0,style:{marginRight:"var(--spacing-small)"},children:o("option",{selected:!0,children:"Loading..."})}):o("select",{value:L.value.provider,onChange:e=>M.updateFilter({provider:e.target.value}),style:{marginRight:"var(--spacing-small)"},children:[o("option",{value:"all",children:"All Providers"})].concat(y.value.providers.map(e=>o("option",{value:e,selected:e===L.value.provider,children:f.drivers.hasOwnProperty(e)?f.drivers[e].name:e})))}),y.value===null?o("select",{disabled:!0,style:{marginRight:"var(--spacing-small)"},children:o("option",{selected:!0,children:"Loading..."})}):o("select",{value:L.value.author,onChange:e=>M.updateFilter({author:e.target.value}),style:{marginRight:"var(--spacing-small)"},children:[o("option",{value:"all",children:"All Authors"})].concat(y.value.authors.map(e=>o("option",{value:e,children:e})))}),o("button",{onClick:()=>M.loadEntries(),style:{cursor:"pointer"},children:"Refresh"})]}),o("div",{class:h.settings.reduceTransparency?"container-solid-dark":"container-glassy-dark",style:{flex:1,display:"flex",flexDirection:"column",minHeight:0},children:[o("div",{style:{width:"100%",height:"0.05rem",backgroundColor:"var(--color-foreground)",opacity:.1}}),y.value===null?o("div",{style:{padding:"var(--spacing-medium)"},children:o("p",{style:{textAlign:"center",opacity:.5},children:"Loading..."})}):o("div",{ref:t,style:{flex:1,display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"var(--spacing-small)",padding:"var(--spacing-medium)",overflowY:"scroll"},children:y.value.filtered.slice(O.value.top,O.value.bottom).map(e=>ti(e))})]})]})};h.layoutSignal.subscribe(t=>{t.entries&&y.value===null&&(M.loadEntries(),M.filterEntries())});const ni=()=>{const t=async i=>{h.updateSource({driver:i}),await f.next()},e=async i=>{h.updateSource({value:i,display:i}),await f.next()};return o("nav",{class:h.settings.reduceTransparency?"container-solid-light shadow":"container-glassy-light shadow",style:{position:"fixed",display:"flex",alignItems:"center",left:"0rem",top:"0rem",width:"100%",height:"3.5rem"},children:[o("h1",{style:{textWrap:"nowrap",marginLeft:"var(--spacing-medium)",marginRight:"var(--spacing-medium)"},children:"Dataset Editor"}),o("button",{onClick:()=>h.updateLayout({help:!h.layout.help}),style:{marginRight:"var(--spacing-medium)",cursor:"pointer"},children:"Help"}),o("button",{onClick:()=>h.updateLayout({settings:!h.layout.settings}),style:{marginRight:"var(--spacing-medium)",cursor:"pointer"},children:"Settings"}),o("div",{style:"flex: 1"}),o("select",{value:h.source.driver,onChange:i=>t(i.target.value),style:{marginRight:"var(--spacing-small)"},children:Object.keys(f.drivers).map(i=>o("option",{value:f.drivers[i].id,children:f.drivers[i].name}))}),o("input",{value:h.source.display,autocomplete:"off",onChange:i=>e(i.target.value),style:{width:"7.5rem",marginRight:"var(--spacing-small)"}}),o("button",{onClick:()=>h.updateLayout({entries:!h.layout.entries}),style:{marginRight:"var(--spacing-medium)",cursor:"pointer"},children:"Entries"})]})},si=()=>o("div",{class:"shadow",style:{display:h.layout.help?"block":"none",border:"0.05rem solid ",borderRadius:"0.5rem",marginRight:"var(--spacing-medium)",marginBottom:"var(--spacing-medium)",overflow:"hidden"},children:[o("h3",{class:h.settings.reduceTransparency?"container-solid-light":"container-glassy-light",style:{padding:"var(--spacing-medium)"},children:"Help"}),o("div",{class:h.settings.reduceTransparency?"container-solid-dark":"container-glassy-dark",children:[o("div",{style:{width:"100%",height:"0.05rem",backgroundColor:"var(--color-foreground)",opacity:.1}}),o("div",{style:{padding:"var(--spacing-medium)"},children:[o("p",{style:{marginBottom:"var(--spacing-small)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"W"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"A"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"S"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"D"}),o("span",{style:{marginRight:"var(--spacing-tiny)"},children:"to move,"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"E"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Q"}),o("span",{children:"to zoom in and out."})]}),o("p",{style:{marginBottom:"var(--spacing-big)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"R"}),o("span",{children:"to reset the camera."})]}),o("p",{style:{marginBottom:"var(--spacing-small)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"1"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"2"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"3"}),o("span",{children:"to change the stroke type."})]}),o("p",{style:{marginBottom:"var(--spacing-small)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Mouse Wheel"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"+"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"="}),o("span",{children:"to change the stroke size."})]}),o("p",{style:{marginBottom:"var(--spacing-big)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"F"}),o("span",{children:"to change the stroke opacity."})]}),o("h5",{style:{marginBottom:"var(--spacing-small)"},children:"Stroke Type 1 or 2"}),o("p",{style:{lineHeight:"var(--size-big)",marginBottom:"var(--spacing-small)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Left Click"}),o("span",{children:"to draw."})]}),o("p",{style:{marginBottom:"var(--spacing-big)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Right Click"}),o("span",{children:"to continue from the last stroke."})]}),o("h5",{style:{marginBottom:"var(--spacing-small)"},children:"Stroke Type 3"}),o("p",{style:{lineHeight:"var(--size-big)",marginBottom:"var(--spacing-small)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Left Click"}),o("span",{children:"to add a point or move a point."})]}),o("p",{style:{marginBottom:"var(--spacing-big)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Right Click"}),o("span",{children:"to complete or edit the last shape."})]}),o("p",{style:{marginBottom:"var(--spacing-small)"},children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"X"}),o("span",{children:"to delete the last stroke or point."})]}),o("p",{children:[o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Z"}),o("span",{style:{marginRight:"var(--spacing-tiny)"},children:"to skip the image,"}),o("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"C"}),o("span",{children:"to submit."})]})]})]})]});ye(o(si,{}),document.getElementById("container-help"));ye(o(ni,{}),document.getElementById("container-navbar"));ye(o(ei,{}),document.getElementById("container-settings"));ye(o(ii,{}),document.getElementById("container-entries"));let Te=performance.now();function Le(){const t=performance.now()-Te;Te=performance.now(),d.update(t),m.update(t),h.settings.fps===0?requestAnimationFrame(Le):setTimeout(Le,1e3/h.settings.fps-(performance.now()-Te))}let Ct=!0;async function ge(){try{const t=await f.drivers[h.source.driver].preload(h.settings.preload);t===null?setTimeout(ge,100):(await fetch(t.url),ge())}catch{Ct=!1}}window.addEventListener("load",()=>{Le(),ge(),f.next(),h.sourceSignal.subscribe(()=>{Ct||ge()})});
