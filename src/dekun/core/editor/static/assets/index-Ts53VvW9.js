(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=i(a);fetch(a.href,r)}})();var Ie,x,mt,ft,Y,Ze,gt,vt,_t,He,Ae,Ne,le={},yt=[],Xt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Te=Array.isArray;function N(t,e){for(var i in e)t[i]=e[i];return t}function Xe(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Ft(t,e,i){var s,a,r,o={};for(r in e)r=="key"?s=e[r]:r=="ref"?a=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?Ie.call(arguments,2):i),typeof t=="function"&&t.defaultProps!=null)for(r in t.defaultProps)o[r]===void 0&&(o[r]=t.defaultProps[r]);return _e(t,o,s,a,null)}function _e(t,e,i,s,a){var r={type:t,props:e,key:i,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++mt,__i:-1,__u:0};return a==null&&x.vnode!=null&&x.vnode(r),r}function de(t){return t.children}function re(t,e){this.props=t,this.context=e}function J(t,e){if(e==null)return t.__?J(t.__,t.__i+1):null;for(var i;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null)return i.__e;return typeof t.type=="function"?J(t):null}function kt(t){var e,i;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((i=t.__k[e])!=null&&i.__e!=null){t.__e=t.__c.base=i.__e;break}return kt(t)}}function Qe(t){(!t.__d&&(t.__d=!0)&&Y.push(t)&&!ke.__r++||Ze!=x.debounceRendering)&&((Ze=x.debounceRendering)||gt)(ke)}function ke(){for(var t,e,i,s,a,r,o,d=1;Y.length;)Y.length>d&&Y.sort(vt),t=Y.shift(),d=Y.length,t.__d&&(i=void 0,a=(s=(e=t).__v).__e,r=[],o=[],e.__P&&((i=N({},s)).__v=s.__v+1,x.vnode&&x.vnode(i),Fe(e.__P,i,s,e.__n,e.__P.namespaceURI,32&s.__u?[a]:null,r,a??J(s),!!(32&s.__u),o),i.__v=s.__v,i.__.__k[i.__i]=i,wt(r,i,o),i.__e!=a&&kt(i)));ke.__r=0}function bt(t,e,i,s,a,r,o,d,u,h,f){var c,_,v,I,B,T,w=s&&s.__k||yt,k=e.length;for(u=Kt(i,e,w,u,k),c=0;c<k;c++)(v=i.__k[c])!=null&&(_=v.__i==-1?le:w[v.__i]||le,v.__i=c,T=Fe(t,v,_,a,r,o,d,u,h,f),I=v.__e,v.ref&&_.ref!=v.ref&&(_.ref&&Ke(_.ref,null,v),f.push(v.ref,v.__c||I,v)),B==null&&I!=null&&(B=I),4&v.__u||_.__k===v.__k?u=xt(v,u,t):typeof v.type=="function"&&T!==void 0?u=T:I&&(u=I.nextSibling),v.__u&=-7);return i.__e=B,u}function Kt(t,e,i,s,a){var r,o,d,u,h,f=i.length,c=f,_=0;for(t.__k=new Array(a),r=0;r<a;r++)(o=e[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(u=r+_,(o=t.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?_e(null,o,null,null,null):Te(o)?_e(de,{children:o},null,null,null):o.constructor==null&&o.__b>0?_e(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=t,o.__b=t.__b+1,d=null,(h=o.__i=Vt(o,i,u,c))!=-1&&(c--,(d=i[h])&&(d.__u|=2)),d==null||d.__v==null?(h==-1&&(a>f?_--:a<f&&_++),typeof o.type!="function"&&(o.__u|=4)):h!=u&&(h==u-1?_--:h==u+1?_++:(h>u?_--:_++,o.__u|=4))):t.__k[r]=null;if(c)for(r=0;r<f;r++)(d=i[r])!=null&&(2&d.__u)==0&&(d.__e==s&&(s=J(d)),Ct(d,d));return s}function xt(t,e,i){var s,a;if(typeof t.type=="function"){for(s=t.__k,a=0;s&&a<s.length;a++)s[a]&&(s[a].__=t,e=xt(s[a],e,i));return e}t.__e!=e&&(e&&t.type&&!i.contains(e)&&(e=J(t)),i.insertBefore(t.__e,e||null),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Vt(t,e,i,s){var a,r,o,d=t.key,u=t.type,h=e[i],f=h!=null&&(2&h.__u)==0;if(h===null&&t.key==null||f&&d==h.key&&u==h.type)return i;if(s>(f?1:0)){for(a=i-1,r=i+1;a>=0||r<e.length;)if((h=e[o=a>=0?a--:r++])!=null&&(2&h.__u)==0&&d==h.key&&u==h.type)return o}return-1}function et(t,e,i){e[0]=="-"?t.setProperty(e,i??""):t[e]=i==null?"":typeof i!="number"||Xt.test(e)?i:i+"px"}function fe(t,e,i,s,a){var r,o;e:if(e=="style")if(typeof i=="string")t.style.cssText=i;else{if(typeof s=="string"&&(t.style.cssText=s=""),s)for(e in s)i&&e in i||et(t.style,e,"");if(i)for(e in i)s&&i[e]==s[e]||et(t.style,e,i[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(_t,"$1")),o=e.toLowerCase(),e=o in t||e=="onFocusOut"||e=="onFocusIn"?o.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+r]=i,i?s?i.u=s.u:(i.u=He,t.addEventListener(e,r?Ne:Ae,r)):t.removeEventListener(e,r?Ne:Ae,r);else{if(a=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=i??"";break e}catch{}typeof i=="function"||(i==null||i===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&i==1?"":i))}}function tt(t){return function(e){if(this.l){var i=this.l[e.type+t];if(e.t==null)e.t=He++;else if(e.t<i.u)return;return i(x.event?x.event(e):e)}}}function Fe(t,e,i,s,a,r,o,d,u,h){var f,c,_,v,I,B,T,w,k,ee,W,pe,te,Je,me,ie,$e,A=e.type;if(e.constructor!=null)return null;128&i.__u&&(u=!!(32&i.__u),r=[d=e.__e=i.__e]),(f=x.__b)&&f(e);e:if(typeof A=="function")try{if(w=e.props,k="prototype"in A&&A.prototype.render,ee=(f=A.contextType)&&s[f.__c],W=f?ee?ee.props.value:f.__:s,i.__c?T=(c=e.__c=i.__c).__=c.__E:(k?e.__c=c=new A(w,W):(e.__c=c=new re(w,W),c.constructor=A,c.render=Gt),ee&&ee.sub(c),c.props=w,c.state||(c.state={}),c.context=W,c.__n=s,_=c.__d=!0,c.__h=[],c._sb=[]),k&&c.__s==null&&(c.__s=c.state),k&&A.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=N({},c.__s)),N(c.__s,A.getDerivedStateFromProps(w,c.__s))),v=c.props,I=c.state,c.__v=e,_)k&&A.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),k&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(k&&A.getDerivedStateFromProps==null&&w!==v&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(w,W),!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(w,c.__s,W)===!1||e.__v==i.__v){for(e.__v!=i.__v&&(c.props=w,c.state=c.__s,c.__d=!1),e.__e=i.__e,e.__k=i.__k,e.__k.some(function(X){X&&(X.__=e)}),pe=0;pe<c._sb.length;pe++)c.__h.push(c._sb[pe]);c._sb=[],c.__h.length&&o.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(w,c.__s,W),k&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(v,I,B)})}if(c.context=W,c.props=w,c.__P=t,c.__e=!1,te=x.__r,Je=0,k){for(c.state=c.__s,c.__d=!1,te&&te(e),f=c.render(c.props,c.state,c.context),me=0;me<c._sb.length;me++)c.__h.push(c._sb[me]);c._sb=[]}else do c.__d=!1,te&&te(e),f=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++Je<25);c.state=c.__s,c.getChildContext!=null&&(s=N(N({},s),c.getChildContext())),k&&!_&&c.getSnapshotBeforeUpdate!=null&&(B=c.getSnapshotBeforeUpdate(v,I)),ie=f,f!=null&&f.type===de&&f.key==null&&(ie=St(f.props.children)),d=bt(t,Te(ie)?ie:[ie],e,i,s,a,r,o,d,u,h),c.base=e.__e,e.__u&=-161,c.__h.length&&o.push(c),T&&(c.__E=c.__=null)}catch(X){if(e.__v=null,u||r!=null)if(X.then){for(e.__u|=u?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;r[r.indexOf(d)]=null,e.__e=d}else{for($e=r.length;$e--;)Xe(r[$e]);De(e)}else e.__e=i.__e,e.__k=i.__k,X.then||De(e);x.__e(X,e,i)}else r==null&&e.__v==i.__v?(e.__k=i.__k,e.__e=i.__e):d=e.__e=qt(i.__e,e,i,s,a,r,o,u,h);return(f=x.diffed)&&f(e),128&e.__u?void 0:d}function De(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(De)}function wt(t,e,i){for(var s=0;s<i.length;s++)Ke(i[s],i[++s],i[++s]);x.__c&&x.__c(e,t),t.some(function(a){try{t=a.__h,a.__h=[],t.some(function(r){r.call(a)})}catch(r){x.__e(r,a.__v)}})}function St(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Te(t)?t.map(St):N({},t)}function qt(t,e,i,s,a,r,o,d,u){var h,f,c,_,v,I,B,T=i.props,w=e.props,k=e.type;if(k=="svg"?a="http://www.w3.org/2000/svg":k=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),r!=null){for(h=0;h<r.length;h++)if((v=r[h])&&"setAttribute"in v==!!k&&(k?v.localName==k:v.nodeType==3)){t=v,r[h]=null;break}}if(t==null){if(k==null)return document.createTextNode(w);t=document.createElementNS(a,k,w.is&&w),d&&(x.__m&&x.__m(e,r),d=!1),r=null}if(k==null)T===w||d&&t.data==w||(t.data=w);else{if(r=r&&Ie.call(t.childNodes),T=i.props||le,!d&&r!=null)for(T={},h=0;h<t.attributes.length;h++)T[(v=t.attributes[h]).name]=v.value;for(h in T)if(v=T[h],h!="children"){if(h=="dangerouslySetInnerHTML")c=v;else if(!(h in w)){if(h=="value"&&"defaultValue"in w||h=="checked"&&"defaultChecked"in w)continue;fe(t,h,null,v,a)}}for(h in w)v=w[h],h=="children"?_=v:h=="dangerouslySetInnerHTML"?f=v:h=="value"?I=v:h=="checked"?B=v:d&&typeof v!="function"||T[h]===v||fe(t,h,v,T[h],a);if(f)d||c&&(f.__html==c.__html||f.__html==t.innerHTML)||(t.innerHTML=f.__html),e.__k=[];else if(c&&(t.innerHTML=""),bt(e.type=="template"?t.content:t,Te(_)?_:[_],e,i,s,k=="foreignObject"?"http://www.w3.org/1999/xhtml":a,r,o,r?r[0]:i.__k&&J(i,0),d,u),r!=null)for(h=r.length;h--;)Xe(r[h]);d||(h="value",k=="progress"&&I==null?t.removeAttribute("value"):I!=null&&(I!==t[h]||k=="progress"&&!I||k=="option"&&I!=T[h])&&fe(t,h,I,T[h],a),h="checked",B!=null&&B!=t[h]&&fe(t,h,B,T[h],a))}return t}function Ke(t,e,i){try{if(typeof t=="function"){var s=typeof t.__u=="function";s&&t.__u(),s&&e==null||(t.__u=t(e))}else t.current=e}catch(a){x.__e(a,i)}}function Ct(t,e,i){var s,a;if(x.unmount&&x.unmount(t),(s=t.ref)&&(s.current&&s.current!=t.__e||Ke(s,null,e)),(s=t.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(r){x.__e(r,e)}s.base=s.__P=null}if(s=t.__k)for(a=0;a<s.length;a++)s[a]&&Ct(s[a],e,i||typeof t.type!="function");i||Xe(t.__e),t.__c=t.__=t.__e=void 0}function Gt(t,e,i){return this.constructor(t,i)}function he(t,e,i){var s,a,r,o;e==document&&(e=document.documentElement),x.__&&x.__(t,e),a=(s=!1)?null:e.__k,r=[],o=[],Fe(e,t=e.__k=Ft(de,null,[t]),a||le,le,e.namespaceURI,a?null:e.firstChild?Ie.call(e.childNodes):null,r,a?a.__e:e.firstChild,s,o),wt(r,t,o)}Ie=yt.slice,x={__e:function(t,e,i,s){for(var a,r,o;e=e.__;)if((a=e.__c)&&!a.__)try{if((r=a.constructor)&&r.getDerivedStateFromError!=null&&(a.setState(r.getDerivedStateFromError(t)),o=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(t,s||{}),o=a.__d),o)return a.__E=a}catch(d){t=d}throw t}},mt=0,ft=function(t){return t!=null&&t.constructor==null},re.prototype.setState=function(t,e){var i;i=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=N({},this.state),typeof t=="function"&&(t=t(N({},i),this.props)),t&&N(i,t),t!=null&&this.__v&&(e&&this._sb.push(e),Qe(this))},re.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Qe(this))},re.prototype.render=de,Y=[],gt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,vt=function(t,e){return t.__v.__b-e.__v.__b},ke.__r=0,_t=/(PointerCapture)$|Capture$/i,He=0,Ae=tt(!1),Ne=tt(!0);var Jt=0;function n(t,e,i,s,a,r){e||(e={});var o,d,u=e;if("ref"in u)for(d in u={},e)d=="ref"?o=e[d]:u[d]=e[d];var h={type:t,props:u,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Jt,__i:-1,__u:0,__source:a,__self:r};if(typeof t=="function"&&(o=t.defaultProps))for(d in o)u[d]===void 0&&(u[d]=o[d]);return x.vnode&&x.vnode(h),h}var ce,$,Pe,it,be=0,It=[],P=x,st=P.__b,nt=P.__r,at=P.diffed,rt=P.__c,ot=P.unmount,lt=P.__;function Ve(t,e){P.__h&&P.__h($,t,be||e),be=0;var i=$.__H||($.__H={__:[],__h:[]});return t>=i.__.length&&i.__.push({}),i.__[t]}function xe(t){return be=1,Zt(Pt,t)}function Zt(t,e,i){var s=Ve(ce++,2);if(s.t=t,!s.__c&&(s.__=[Pt(void 0,e),function(d){var u=s.__N?s.__N[0]:s.__[0],h=s.t(u,d);u!==h&&(s.__N=[h,s.__[1]],s.__c.setState({}))}],s.__c=$,!$.__f)){var a=function(d,u,h){if(!s.__c.__H)return!0;var f=s.__c.__H.__.filter(function(_){return!!_.__c});if(f.every(function(_){return!_.__N}))return!r||r.call(this,d,u,h);var c=s.__c.props!==d;return f.forEach(function(_){if(_.__N){var v=_.__[0];_.__=_.__N,_.__N=void 0,v!==_.__[0]&&(c=!0)}}),r&&r.call(this,d,u,h)||c};$.__f=!0;var r=$.shouldComponentUpdate,o=$.componentWillUpdate;$.componentWillUpdate=function(d,u,h){if(this.__e){var f=r;r=void 0,a(d,u,h),r=f}o&&o.call(this,d,u,h)},$.shouldComponentUpdate=a}return s.__N||s.__}function Tt(t,e){var i=Ve(ce++,3);!P.__s&&$t(i.__H,e)&&(i.__=t,i.u=e,$.__H.__h.push(i))}function G(t){return be=5,Rt(function(){return{current:t}},[])}function Rt(t,e){var i=Ve(ce++,7);return $t(i.__H,e)&&(i.__=t(),i.__H=e,i.__h=t),i.__}function Qt(){for(var t;t=It.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(ye),t.__H.__h.forEach(We),t.__H.__h=[]}catch(e){t.__H.__h=[],P.__e(e,t.__v)}}P.__b=function(t){$=null,st&&st(t)},P.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),lt&&lt(t,e)},P.__r=function(t){nt&&nt(t),ce=0;var e=($=t.__c).__H;e&&(Pe===$?(e.__h=[],$.__h=[],e.__.forEach(function(i){i.__N&&(i.__=i.__N),i.u=i.__N=void 0})):(e.__h.forEach(ye),e.__h.forEach(We),e.__h=[],ce=0)),Pe=$},P.diffed=function(t){at&&at(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(It.push(e)!==1&&it===P.requestAnimationFrame||((it=P.requestAnimationFrame)||ei)(Qt)),e.__H.__.forEach(function(i){i.u&&(i.__H=i.u),i.u=void 0})),Pe=$=null},P.__c=function(t,e){e.some(function(i){try{i.__h.forEach(ye),i.__h=i.__h.filter(function(s){return!s.__||We(s)})}catch(s){e.some(function(a){a.__h&&(a.__h=[])}),e=[],P.__e(s,i.__v)}}),rt&&rt(t,e)},P.unmount=function(t){ot&&ot(t);var e,i=t.__c;i&&i.__H&&(i.__H.__.forEach(function(s){try{ye(s)}catch(a){e=a}}),i.__H=void 0,e&&P.__e(e,i.__v))};var ct=typeof requestAnimationFrame=="function";function ei(t){var e,i=function(){clearTimeout(s),ct&&cancelAnimationFrame(e),setTimeout(t)},s=setTimeout(i,35);ct&&(e=requestAnimationFrame(i))}function ye(t){var e=$,i=t.__c;typeof i=="function"&&(t.__c=void 0,i()),$=e}function We(t){var e=$;t.__c=t.__(),$=e}function $t(t,e){return!t||t.length!==e.length||e.some(function(i,s){return i!==t[s]})}function Pt(t,e){return typeof e=="function"?e(t):e}var ti=Symbol.for("preact-signals");function Re(){if(U>1)U--;else{for(var t,e=!1;oe!==void 0;){var i=oe;for(oe=void 0,Ue++;i!==void 0;){var s=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&Lt(i))try{i.c()}catch(a){e||(t=a,e=!0)}i=s}}if(Ue=0,U--,e)throw t}}function Et(t){if(U>0)return t();U++;try{return t()}finally{Re()}}var b=void 0;function Mt(t){var e=b;b=void 0;try{return t()}finally{b=e}}var oe=void 0,U=0,Ue=0,we=0;function Ot(t){if(b!==void 0){var e=t.n;if(e===void 0||e.t!==b)return e={i:0,S:t,p:b.s,n:void 0,t:b,e:void 0,x:void 0,r:e},b.s!==void 0&&(b.s.n=e),b.s=e,t.n=e,32&b.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=b.s,e.n=void 0,b.s.n=e,b.s=e),e}}function L(t,e){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}L.prototype.brand=ti;L.prototype.h=function(){return!0};L.prototype.S=function(t){var e=this,i=this.t;i!==t&&t.e===void 0&&(t.x=i,this.t=t,i!==void 0?i.e=t:Mt(function(){var s;(s=e.W)==null||s.call(e)}))};L.prototype.U=function(t){var e=this;if(this.t!==void 0){var i=t.e,s=t.x;i!==void 0&&(i.x=s,t.e=void 0),s!==void 0&&(s.e=i,t.x=void 0),t===this.t&&(this.t=s,s===void 0&&Mt(function(){var a;(a=e.Z)==null||a.call(e)}))}};L.prototype.subscribe=function(t){var e=this;return ue(function(){var i=e.value,s=b;b=void 0;try{t(i)}finally{b=s}},{name:"sub"})};L.prototype.valueOf=function(){return this.value};L.prototype.toString=function(){return this.value+""};L.prototype.toJSON=function(){return this.value};L.prototype.peek=function(){var t=b;b=void 0;try{return this.value}finally{b=t}};Object.defineProperty(L.prototype,"value",{get:function(){var t=Ot(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(Ue>100)throw new Error("Cycle detected");this.v=t,this.i++,we++,U++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{Re()}}}});function D(t,e){return new L(t,e)}function Lt(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Bt(t){for(var e=t.s;e!==void 0;e=e.n){var i=e.S.n;if(i!==void 0&&(e.r=i),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function zt(t){for(var e=t.s,i=void 0;e!==void 0;){var s=e.p;e.i===-1?(e.S.U(e),s!==void 0&&(s.n=e.n),e.n!==void 0&&(e.n.p=s)):i=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=s}t.s=i}function H(t,e){L.call(this,void 0),this.x=t,this.s=void 0,this.g=we-1,this.f=4,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}H.prototype=new L;H.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===we))return!0;if(this.g=we,this.f|=1,this.i>0&&!Lt(this))return this.f&=-2,!0;var t=b;try{Bt(this),b=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(i){this.v=i,this.f|=16,this.i++}return b=t,zt(this),this.f&=-2,!0};H.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}L.prototype.S.call(this,t)};H.prototype.U=function(t){if(this.t!==void 0&&(L.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};H.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};Object.defineProperty(H.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=Ot(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function dt(t,e){return new H(t,e)}function jt(t){var e=t.u;if(t.u=void 0,typeof e=="function"){U++;var i=b;b=void 0;try{e()}catch(s){throw t.f&=-2,t.f|=8,qe(t),s}finally{b=i,Re()}}}function qe(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,jt(t)}function ii(t){if(b!==this)throw new Error("Out-of-order effect");zt(this),b=t,this.f&=-2,8&this.f&&qe(this),Re()}function Z(t,e){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=e?.name}Z.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{t()}};Z.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,jt(this),Bt(this),U++;var t=b;return b=this,ii.bind(this,t)};Z.prototype.N=function(){2&this.f||(this.f|=2,this.o=oe,oe=this)};Z.prototype.d=function(){this.f|=8,1&this.f||qe(this)};Z.prototype.dispose=function(){this.d()};function ue(t,e){var i=new Z(t,e);try{i.c()}catch(a){throw i.d(),a}var s=i.d.bind(i);return s[Symbol.dispose]=s,s}var At,Ee,Nt=[];ue(function(){At=this.N})();function Q(t,e){x[t]=e.bind(null,x[t]||function(){})}function Se(t){Ee&&Ee(),Ee=t&&t.S()}function Dt(t){var e=this,i=t.data,s=ni(i);s.value=i;var a=Rt(function(){for(var d=e,u=e.__v;u=u.__;)if(u.__c){u.__c.__$f|=4;break}var h=dt(function(){var v=s.value.value;return v===0?0:v===!0?"":v||""}),f=dt(function(){return!Array.isArray(h.value)&&!ft(h.value)}),c=ue(function(){if(this.N=Wt,f.value){var v=h.value;d.__v&&d.__v.__e&&d.__v.__e.nodeType===3&&(d.__v.__e.data=v)}}),_=e.__$u.d;return e.__$u.d=function(){c(),_.call(this)},[f,h]},[]),r=a[0],o=a[1];return r.value?o.peek():o.value}Dt.displayName="ReactiveTextNode";Object.defineProperties(L.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Dt},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});Q("__b",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),typeof e.type=="string"){var i,s=e.props;for(var a in s)if(a!=="children"){var r=s[a];r instanceof L&&(i||(e.__np=i={}),i[a]=r,s[a]=r.peek())}}t(e)});Q("__r",function(t,e){if(typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(e.type.displayName||e.type.name||"Unknown"),e.type!==de){Se();var i,s=e.__c;s&&(s.__$f&=-2,(i=s.__$u)===void 0&&(s.__$u=i=(function(a){var r;return ue(function(){r=this}),r.c=function(){s.__$f|=1,s.setState({})},r})())),Se(i)}t(e)});Q("__e",function(t,e,i,s){typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),Se(),t(e,i,s)});Q("diffed",function(t,e){typeof e.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),Se();var i;if(typeof e.type=="string"&&(i=e.__e)){var s=e.__np,a=e.props;if(s){var r=i.U;if(r)for(var o in r){var d=r[o];d!==void 0&&!(o in s)&&(d.d(),r[o]=void 0)}else r={},i.U=r;for(var u in s){var h=r[u],f=s[u];h===void 0?(h=si(i,u,f,a),r[u]=h):h.o(f,a)}}}t(e)});function si(t,e,i,s){var a=e in t&&t.ownerSVGElement===void 0,r=D(i);return{o:function(o,d){r.value=o,s=d},d:ue(function(){this.N=Wt;var o=r.value.value;s[e]!==o&&(s[e]=o,a?t[e]=o:o?t.setAttribute(e,o):t.removeAttribute(e))})}}Q("unmount",function(t,e){if(typeof e.type=="string"){var i=e.__e;if(i){var s=i.U;if(s){i.U=void 0;for(var a in s){var r=s[a];r&&r.d()}}}}else{var o=e.__c;if(o){var d=o.__$u;d&&(o.__$u=void 0,d.d())}}t(e)});Q("__h",function(t,e,i,s){(s<3||s===9)&&(e.__$f|=2),t(e,i,s)});re.prototype.shouldComponentUpdate=function(t,e){var i=this.__$u,s=i&&i.s!==void 0;for(var a in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var r=2&this.__$f;if(!(s||r||4&this.__$f)||1&this.__$f)return!0}else if(!(s||4&this.__$f)||3&this.__$f)return!0;for(var o in t)if(o!=="__source"&&t[o]!==this.props[o])return!0;for(var d in this.props)if(!(d in t))return!0;return!1};function ni(t,e){return xe(function(){return D(t,e)})[0]}var ai=function(t){queueMicrotask(function(){queueMicrotask(t)})};function ri(){Et(function(){for(var t;t=Nt.shift();)At.call(t)})}function Wt(){Nt.push(this)===1&&(x.requestAnimationFrame||ai)(ri)}const M=t=>{const[e,i]=xe(!1),[s,a]=xe(R([])),r=G(new Set),o=G(0),d=()=>{r.current.clear(),o.current=0,i(!0),a(R([]))},u=c=>{c=c.toLowerCase(),e&&(c==="escape"?(i(!1),a(l.keybinds[t.id])):(r.current.add(c),o.current++,a(R(Array.from(r.current)))))};return n("button",{onClick:d,onKeyDown:c=>u(c.key),onKeyUp:()=>{if(console.log(!0),e&&(o.current--,o.current===0)){i(!1);const c={};c[t.id]=s,l.updateKeybind(c)}},onFocusOut:()=>{i(!1),a(l.keybinds[t.id])},style:{backgroundColor:"color-mix(in srgb, var(--color-foreground), transparent 80%)",color:e?"color-mix(in srgb, var(--color-foreground), transparent 75%)":"var(--color-foreground)",border:"none",borderRadius:"0.25rem",fontSize:"calc(var(--size-tiny) * 0.75)",minWidth:"5rem",padding:"calc(var(--spacing-tiny) * 0.75) var(--spacing-small)",cursor:"pointer"},children:e?o.current===0?"Enter Combination":O(s):O(l.keybinds[t.id])})},oi=()=>n("div",{class:"shadow",style:{display:l.layout.keybinds?"block":"none",border:"0.05rem solid ",borderRadius:"0.5rem",marginRight:"var(--spacing-medium)",marginBottom:"var(--spacing-medium)",overflow:"hidden"},children:[n("div",{class:l.settings.reduceTransparency?"container-solid-light":"container-glassy-light",style:{display:"flex",alignItems:"center",padding:"var(--spacing-medium)"},children:[n("h3",{style:{flex:1},children:"Keybinds"}),n("button",{onClick:()=>l.updateKeybind(l.defaultKeybinds),children:"Reset"})]}),n("div",{class:l.settings.reduceTransparency?"container-solid-dark":"container-glassy-dark",children:[n("div",{style:{width:"100%",height:"0.05rem",backgroundColor:"var(--color-foreground)",opacity:.1}}),n("div",{style:{padding:"var(--spacing-medium)",overflowX:"auto"},children:[n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Move Left:"}),n(M,{id:"moveLeft"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Move Right:"}),n(M,{id:"moveRight"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Move Up:"}),n(M,{id:"moveUp"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Move Down:"}),n(M,{id:"moveDown"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Zoom In:"}),n(M,{id:"zoomIn"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Zoom Out:"}),n(M,{id:"zoomOut"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Reset Camera:"}),n(M,{id:"resetCamera"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Change Stroke Type to 1:"}),n(M,{id:"changeStrokeType1"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Change Stroke Type to 2:"}),n(M,{id:"changeStrokeType2"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Change Stroke Type to 3:"}),n(M,{id:"changeStrokeType3"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Increase Stroke Size:"}),n(M,{id:"increaseStrokeSize"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Decrease Stroke Size:"}),n(M,{id:"decreaseStrokeSize"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Change Stroke Opacity:"}),n(M,{id:"changeStrokeOpacity"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Remove Last Stroke or Point:"}),n(M,{id:"undoLastAction"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Skip Current Image:"}),n(M,{id:"skipImage"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Submit Current Image:"}),n(M,{id:"submitImage"})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-small)"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Jump to Bottom Entry:"}),n(M,{id:"jumpToTopEntry"})]}),n("div",{style:{display:"flex",alignItems:"center"},children:[n("p",{style:{marginRight:"var(--spacing-small)"},children:"Jump to Top Entry:"}),n(M,{id:"jumpToBottomEntry"})]})]})]})]});function R(t){return{keys:t.filter(e=>e.length===1),modifiers:{control:t.includes("control"),option:t.includes("alt"),meta:t.includes("meta"),shift:t.includes("shift")}}}function O(t){const e=[];return t.modifiers.control&&e.push("Control"),t.modifiers.option&&e.push("Option"),t.modifiers.meta&&e.push("Meta"),t.modifiers.shift&&e.push("Shift"),e.concat(t.keys.map(i=>i.toUpperCase())).join(" + ")}const F=[];async function ht(){const t=await(await fetch("/api/drivers/danbooru/random")).text(),e=await(await fetch(`/api/drivers/danbooru/post/${t}`)).json();return{id:t,page:1,url:`/resource/danbooru/${e.file_url.substring(e.file_url.lastIndexOf("/")+1)}`,source:`${t}/1`}}const li={id:"danbooru",name:"Danbooru",async next(t){if(t.split("/").map(i=>i.trim()).filter(i=>i.length>0).length>0){const i=await(await fetch(`/api/drivers/danbooru/post/${t[0]}`)).json();return{id:t[0],page:1,url:`/resource/danbooru/${i.file_url.substring(i.file_url.lastIndexOf("/")+1)}`,source:`${t[0]}/1`}}return F.length>0?Object.assign(F.splice(0,1)[0],{source:""}):Object.assign(await ht(),{source:""})},async preload(t){if(F.length<t){const e=F[F.push(await ht())-1];return{id:e.id,page:e.page,url:e.url,amount:F.length}}}},ci=Object.freeze(Object.defineProperty({__proto__:null,default:li},Symbol.toStringTag,{value:"Module"}));let Me=null,S=null;const K=[];async function ut(){Me===null&&(Me=await(await fetch("/api/drivers/nhentai/latest")).json());const t=Math.round(Math.random()*Me),e=await(await fetch(`/api/drivers/nhentai/pages/${t}`)).json(),i=Math.floor(Math.random()*e.length),s=e[i].split("/");return{id:t.toString(),page:i+1,url:`/resource/nhentai/${s.slice(4,6).join("/")}`,source:`${t}/${i+1}`}}const di={id:"nhentai",name:"nHentai",async next(t){const e=t.split("/").map(i=>i.trim()).filter(i=>i.length>0);if(e.length>0){if(S===null||e[0]!==S.id)S={id:e[0],pages:(await(await fetch(`/api/drivers/nhentai/pages/${e[0]}`)).json()).map(i=>`/resource/nhentai/${i.split("/").slice(4,6).join("/")}`),index:e.length>1?parseInt(e[1])-1:0,cacheIndex:e.length>1?parseInt(e[1])-1:0};else{const i=isNaN(parseInt(e[1]))?1:parseInt(e[1])-1;S.index=i===S.index?S.index+1:i}return S.index>=S.pages.length?(S=null,await this.next("")):{id:S.id,page:S.index+1,url:S.pages[S.index],source:`${S.id}/${S.index+1}`}}return K.length>0?Object.assign(K.splice(0,1)[0],{source:""}):Object.assign(await ut(),{source:""})},async preload(t){if(S===null){if(K.length<t){const e=K[K.push(await ut())-1];return{id:e.id,page:e.page,url:e.url,amount:K.length}}}else if(S.cacheIndex<Math.min(S.index+t,S.pages.length))return S.cacheIndex++,{id:S.id,page:S.cacheIndex,url:S.pages[S.cacheIndex-1],amount:S.cacheIndex-S.index}}},hi=Object.freeze(Object.defineProperty({__proto__:null,default:di},Symbol.toStringTag,{value:"Module"}));let C=null;const V=[];async function pt(){const t=(await(await fetch("/api/drivers/pixiv/discovery")).json()).body.illusts,e=t[Math.floor(Math.random()*t.length)],i=(await(await fetch(`/api/drivers/pixiv/pages/${e.id}`)).json()).body,s=Math.floor(Math.random()*e.pageCount),a=i[s].urls.original.split("/");return{id:`${e.id}`,page:s+1,url:`/resource/pixiv/${a.slice(5,11).join("-")}/${a[11]}`,source:`${e.id}/${s+1}`}}const ui={id:"pixiv",name:"Pixiv",async next(t){const e=t.split("/").map(i=>i.trim()).filter(i=>i.length>0);if(e.length>0){if(C===null||e[0]!==C.id)C={id:e[0],pages:(await(await fetch(`/api/drivers/pixiv/pages/${e[0]}`)).json()).body.map(i=>{const s=i.urls.original.split("/");return`/resource/pixiv/${s.slice(5,11).join("-")}/${s[11]}`}),index:e.length>1?parseInt(e[1])-1:0,cacheIndex:e.length>1?parseInt(e[1])-1:0};else{const i=isNaN(parseInt(e[1]))?1:parseInt(e[1])-1;C.index=i===C.index?C.index+1:i}return C.index>=C.pages.length?(C=null,await this.next("")):{id:C.id,page:C.index+1,url:C.pages[C.index],source:`${C.id}/${C.index+1}`}}return V.length>0?Object.assign(V.splice(0,1)[0],{source:""}):Object.assign(await pt(),{source:""})},preload:async t=>{if(C===null){if(V.length<t){const e=V[V.push(await pt())-1];return{id:e.id,page:e.page,url:e.url,amount:V.length}}}else if(C.cacheIndex<Math.min(C.index+t,C.pages.length))return C.cacheIndex++,{id:C.id,page:C.cacheIndex,url:C.pages[C.cacheIndex-1],amount:C.cacheIndex-C.index};return null}},pi=Object.freeze(Object.defineProperty({__proto__:null,default:ui},Symbol.toStringTag,{value:"Module"})),Oe=Object.assign({"./drivers/danbooru.ts":ci,"./drivers/nhentai.ts":hi,"./drivers/pixiv.ts":pi});class m{static canvas=document.createElement("canvas");static ctx=this.canvas.getContext("2d");static overlayCanvas=document.createElement("canvas");static overlayCtx=this.overlayCanvas.getContext("2d");static submitCanvas=document.createElement("canvas");static submitCtx=this.submitCanvas.getContext("2d");static drivers={pixiv:Oe["./drivers/pixiv.ts"].default,nhentai:Oe["./drivers/nhentai.ts"].default,danbooru:Oe["./drivers/danbooru.ts"].default};static data=null;static timestamp=0;static async next(e){l.updateSource({locked:!0});const i=this.data,s=performance.now();this.data=null,this.timestamp=performance.now();try{const a=e===void 0?l.source.driver:e.driver,r=await this.drivers[a].next(e===void 0?l.source.value:`${e.id}/${e.page}`);if(r===null)this.data=i;else{l.updateSource({value:r.source,display:`${r.id}/${r.page}`,duplicate:await(await fetch(`/api/check/${a}/${r.id}/${r.page}`)).json()});const o=document.createElement("img");o.src=r.url,o.addEventListener("load",()=>{this.timestamp===s&&(this.data={provider:a,id:r.id,page:r.page,element:o,transform:this.calculateTransform(o.width,o.height),strokes:[]},this.canvas.width=o.width,this.canvas.height=o.height,this.overlayCanvas.width=o.width,this.overlayCanvas.height=o.height,l.settings.randomStrokes&&(this.generateRandomStrokes(),this.renderImage()),g.reset(),p.reset())})}}catch{this.data=i}l.updateSource({locked:!1})}static async submit(){if(this.data!==null){const e=this.data;this.data=null,g.reset(),p.reset(),this.submitCanvas.width=e.element.width,this.submitCanvas.height=e.element.height,this.submitCtx.fillStyle="white",this.submitCtx.strokeStyle="white";for(const a of e.strokes)if(a.type===1||a.type===2)this.submitCtx.lineCap=a.type===1?"butt":"round",this.submitCtx.lineWidth=(e.element.width+e.element.height)*(a.size*.0025),this.submitCtx.moveTo(a.x1,a.y1),this.submitCtx.lineTo(a.x2,a.y2),this.submitCtx.stroke(),this.submitCtx.beginPath();else if(a.type===3){for(const[r,o]of a.points.entries())r===0?this.submitCtx.moveTo(o.x,o.y):this.submitCtx.lineTo(o.x,o.y);this.submitCtx.lineTo(a.points[0].x,a.points[0].y),this.submitCtx.fill(),this.submitCtx.beginPath()}const i=this.submitCanvas.toDataURL("image/png",1).substring(22);this.submitCtx.clearRect(0,0,this.submitCanvas.width,this.submitCanvas.height),this.submitCtx.imageSmoothingEnabled=!1,this.submitCtx.drawImage(e.element,0,0,this.submitCanvas.width,this.submitCanvas.height);const s=this.submitCanvas.toDataURL("image/jpeg",1).substring(23);try{await fetch("/api/submit",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e.provider,id:e.id,page:e.page,image:s,mask:i,author:l.settings.username})}),await this.next()}catch{this.data=e}}}static renderImage(){if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.imageSmoothingEnabled=!1,this.data!==null&&p.strokeOpacity>0){this.ctx.fillStyle=`rgba(0,255,0,${p.strokeOpacity})`,this.ctx.strokeStyle=`rgba(0,255,0,${p.strokeOpacity})`;for(const e of this.data.strokes)if(e.type===1||e.type===2)this.ctx.lineCap=e.type===1?"butt":"round",this.ctx.lineWidth=(this.data.element.width+this.data.element.height)*(e.size*.0025),this.ctx.moveTo(e.x1,e.y1),this.ctx.lineTo(e.x2,e.y2),this.ctx.stroke(),this.ctx.beginPath();else if(e.type===3){for(const[i,s]of e.points.entries())i===0?this.ctx.moveTo(s.x,s.y):this.ctx.lineTo(s.x,s.y);this.ctx.lineTo(e.points[0].x,e.points[0].y),this.ctx.fill(),this.ctx.beginPath()}}return this.canvas}static renderOverlay(){if(this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.overlayCtx.imageSmoothingEnabled=!1,this.data!==null){if(this.overlayCtx.fillStyle="rgba(0,255,0,0.5)",this.overlayCtx.strokeStyle="rgba(0,255,0,0.5)",p.strokeType===1||p.strokeType===2)p.startX!==null&&p.startY!==null&&(this.overlayCtx.lineCap=p.strokeType===1?"butt":"round",this.overlayCtx.lineWidth=(this.data.element.width+this.data.element.height)*(p.strokeSize*.0025),this.overlayCtx.moveTo(p.startX,p.startY),this.overlayCtx.lineTo(p.mouse.imageX,p.mouse.imageY),this.overlayCtx.stroke(),this.overlayCtx.beginPath());else if(p.strokeType===3){for(const[e,i]of p.strokePoints.entries())e===0?this.overlayCtx.moveTo(i.x,i.y):this.overlayCtx.lineTo(i.x,i.y);p.strokePoints.length>2&&this.overlayCtx.lineTo(p.strokePoints[0].x,p.strokePoints[0].y),this.overlayCtx.fill(),this.overlayCtx.beginPath()}}return this.overlayCanvas}static async preload(){return await m.drivers[l.source.driver].preload(l.settings.preload)}static updateTransform(){this.data!==null&&(this.data.transform=this.calculateTransform(this.data.element.width,this.data.element.height))}static calculateTransform(e,i){const s=g.canvas.width/g.canvas.height,a=e/i;let r,o;a>s?(r=g.canvas.width,o=g.canvas.width/a):(r=g.canvas.height*a,o=g.canvas.height);const d=3.5*parseFloat(getComputedStyle(document.documentElement).fontSize)*l.settings.resolution;return r*=.9,o*=.9,o-=d/2,{x:(g.canvas.width-r)/2,y:(g.canvas.height+d-o)/2,width:r,height:o,widthScale:r/e,heightScale:o/i}}static generateRandomStrokes(){if(this.data!==null){this.data.strokes=[];for(let e=0;e<(this.data.element.width+this.data.element.height)/50;e++)if(Math.random()>.1){const s=Math.random()*this.data.element.width,a=Math.random()*this.data.element.height,r=Math.random()*((this.data.element.width+this.data.element.width)/2.5),o=Math.random()*360*(Math.PI/180);this.data.strokes.push({type:Math.random()>.75?2:1,size:Math.max(.1,Math.random())*10,x1:s,y1:a,x2:s+r*Math.cos(o),y2:a+r*Math.sin(o)})}else{const s=Math.random()*this.data.element.width,a=Math.random()*this.data.element.height;this.data.strokes.push({type:2,size:Math.max(.5,Math.random())*25,x1:s,y1:a,x2:s,y2:a})}}}}function Ge(t,e){return localStorage.hasOwnProperty(t)?Object.assign(e,JSON.parse(localStorage.getItem(t))):e}const ge=D({help:!1,settings:!1,keybinds:!1,entries:!1}),Ut={username:"unknown",fps:0,resolution:window.devicePixelRatio,preload:5,trackpad:!1,moveSpeed:1,scaleSpeed:1,randomStrokes:!1,reduceTransparency:!1},Yt={moveLeft:R(["a"]),moveRight:R(["d"]),moveUp:R(["w"]),moveDown:R(["s"]),zoomIn:R(["e"]),zoomOut:R(["q"]),resetCamera:R(["r"]),changeStrokeType1:R(["1"]),changeStrokeType2:R(["2"]),changeStrokeType3:R(["3"]),increaseStrokeSize:R(["="]),decreaseStrokeSize:R(["-"]),changeStrokeOpacity:R(["f"]),undoLastAction:R(["x"]),skipImage:R(["z"]),submitImage:R(["c"]),jumpToTopEntry:R(["t"]),jumpToBottomEntry:R(["b"])},se=D(Ge("settings",Ut)),ne=D(Ge("keybinds",Yt)),ae=D(Ge("source",{driver:Object.keys(m.drivers)[0],value:"",display:"",locked:!1,duplicate:!1}));class l{static get layout(){return ge.value}static get settings(){return se.value}static get keybinds(){return ne.value}static get source(){return ae.value}static get layoutSignal(){return ge}static get settingsSignal(){return se}static get keybindsSignal(){return ne}static get sourceSignal(){return ae}static get defaultSettings(){return Ut}static get defaultKeybinds(){return Yt}static updateLayout(e){ge.value={...ge.value,...e}}static updateSettings(e){se.value={...se.value,...e},localStorage.setItem("settings",JSON.stringify(se.value))}static updateKeybind(e){ne.value={...ne.value,...e},localStorage.setItem("keybinds",JSON.stringify(ne.value))}static updateSource(e){ae.value={...ae.value,...e},localStorage.setItem("source",JSON.stringify(ae.value))}}const q=new EventTarget,y=D(null),z=D({provider:"all",author:"all"}),j=D({top:0,bottom:0});class E{static loading=0;static loadingImages=new Set;static async loadEntries(){y.value=null;const e=await(await fetch("/api/list")).json(),i=[],s=[];for(const a of e){const r=a.split("-");i.includes(r[0])||i.push(r[0]),s.includes(r[3])||s.push(r[3])}y.value={entries:e,filtered:[],providers:i,authors:s},this.updateFilter({})}static filterEntries(){if(y.value!==null){const e=[];for(const i of y.value.entries){const s=i.split("-");(z.value.provider==="all"||s[0]===z.value.provider)&&(z.value.author==="all"||s[3]===z.value.author)&&e.push(i)}y.value={entries:y.value.entries,filtered:e,providers:y.value.providers,authors:y.value.authors}}this.loadBottom(10,20,0,0)}static updateFilter(e){z.value=Object.assign(z.value,e),y.value!==null&&(z.value.provider!=="all"&&!y.value.providers.includes(z.value.provider)&&(z.value.provider=y.value.providers.length>0?y.value.providers[0]:"all"),z.value.author!=="all"&&!y.value.authors.includes(z.value.author)&&(z.value.author=y.value.authors.length>0?y.value.authors[0]:"all")),this.filterEntries()}static loadTop(e,i,s,a){if(y.value!==null){let r=s!==void 0?s:j.value.top,o=a!==void 0?a:j.value.bottom;if(Math.abs(r-o)>i)for(let d=0;d<e;d++)o--;for(let d=0;d<e&&r>0;d++)r--;j.value={top:r,bottom:o}}}static loadBottom(e,i,s,a){if(y.value!==null){let r=s!==void 0?s:j.value.top,o=a!==void 0?a:j.value.bottom;if(Math.abs(r-o)>i)for(let d=0;d<e;d++)r++;for(let d=0;d<e&&o<y.value.filtered.length;d++)o++;j.value={top:r,bottom:o}}}static jumpTop(){y.value!==null&&(this.loadBottom(10,20,0,0),q.dispatchEvent(new Event("jumpTop")))}static jumpBottom(){y.value!==null&&(E.loadTop(10,20,y.value.filtered.length-1,y.value.filtered.length-1),q.dispatchEvent(new Event("jumpBottom")))}}const mi=t=>{const e=G(null),i=G(null),s=G(null),[a,r]=xe(!0),o=c=>{E.loadingImages.delete(`${c.substring(c.lastIndexOf("/")+1)}-image`),console.log("Loaded",E.loadingImages.size,c.substring(c.lastIndexOf("/")+1))},d=c=>{E.loadingImages.delete(`${c.substring(c.lastIndexOf("/")+1)}-mask`),console.log("Loaded",E.loadingImages.size,c.substring(c.lastIndexOf("/")+1))},u=()=>{m.drivers.hasOwnProperty(f[0])&&(m.next({driver:f[0],id:f[1],page:f[2]}),l.updateLayout({help:!1,settings:!1,entries:!1}))},h=async()=>{if(y.value!==null){await fetch(`/api/remove/${t}`,{method:"DELETE"});const c=y.value.entries.indexOf(t),_=[...y.value.entries.slice(0,c),...y.value.entries.slice(c+1)],v=y.value.filtered.indexOf(t),I=[...y.value.filtered.slice(0,v),...y.value.filtered.slice(v+1)],B=[],T=[];for(const w of _){const k=w.split("-");B.includes(k[0])||B.push(k[0]),T.includes(k[3])||T.push(k[3])}Et(()=>{y.value={entries:_,filtered:I,providers:B,authors:T},j.value={top:Math.min(_.length-1,j.value.top),bottom:Math.min(_.length-1,j.value.bottom)}})}};Tt(()=>{t!==e.current&&(E.loadingImages.delete(`${e.current}-image`),E.loadingImages.delete(`${e.current}-mask`),e.current=t,i.current!==null&&!i.current.complete&&E.loadingImages.add(`${t}-image`),s.current!==null&&!s.current.complete&&E.loadingImages.add(`${t}-mask`))});const f=t.split("-");return n("div",{children:[n("div",{style:{position:"relative",width:"100%",marginBottom:"-0.25rem",userSelect:"none"},children:[n("img",{ref:i,src:`/resource/image/${t}`,onLoad:c=>o(c.target.src),style:{contentVisibility:"auto",borderRadius:"0.25rem 0.25rem 0rem 0rem",width:"100%"}}),n("img",{ref:s,src:`/resource/mask/${t}`,onLoad:c=>d(c.target.src),onClick:()=>r(!a),style:{position:"absolute",contentVisibility:"auto",borderRadius:"0.25rem 0.25rem 0rem 0rem",left:"0rem",top:"0rem",width:"100%",filter:"invert(46%) sepia(88%) saturate(3060%) hue-rotate(87deg) brightness(126%) contrast(119%)",opacity:a?1:0,cursor:"pointer"}})]}),n("div",{style:{display:"flex",backgroundColor:"var(--color-container-light)",borderRadius:"0rem 0rem 0.25rem 0.25rem",padding:"var(--spacing-small)"},children:[n("h5",{style:{marginRight:"var(--spacing-tiny)"},children:[m.drivers.hasOwnProperty(f[0])?m.drivers[f[0]].name:f[0],":"]}),n("p",{style:{flex:1,marginRight:"var(--spacing-small)"},children:[f[1],"/",f[2]," (",f[3],")"]}),n("button",{onClick:h,style:{marginRight:"var(--spacing-small)",cursor:"pointer"},children:"Remove"}),n("button",{onClick:u,style:{cursor:"pointer"},children:"Edit"})]})]},t)},fi=()=>{const t=G(null);return Tt(()=>{if(t.current!==null){const e=setInterval(()=>{t.current!==null&&y.value!==null&&E.loadingImages.size===0&&(j.value.top>0&&t.current.scrollTop<window.innerHeight/5?E.loadTop(10,20):Math.round(t.current.scrollTop+t.current.clientHeight)>=t.current.scrollHeight-window.innerHeight/5&&E.loadBottom(10,20))},100),i=()=>{t.current!==null&&t.current.scrollTo(0,0)},s=()=>{t.current!==null&&t.current.scrollTo(0,t.current.clientHeight)};return q.addEventListener("jumpTop",i),q.addEventListener("jumpBottom",s),()=>{clearInterval(e),q.removeEventListener("jumpTop",i),q.removeEventListener("jumpBottom",s)}}}),n("div",{class:"shadow",style:{display:l.layout.entries?"flex":"none",flexDirection:"column",border:"0.05rem solid ",borderRadius:"0.5rem",width:"50rem",maxWidth:"calc(100dvw - calc(var(--spacing-medium) * 2))",maxHeight:"calc(100dvh - calc(3.5rem + calc(var(--spacing-medium) * 2)))",overflow:"hidden"},children:[n("div",{class:l.settings.reduceTransparency?"container-solid-light":"container-glassy-light",style:{display:"flex",padding:"var(--spacing-medium)"},children:[n("div",{style:{flex:1,display:"flex",alignItems:"center",marginRight:"var(--spacing-medium)"},children:[n("h3",{children:"Entries"}),y.value===null?void 0:n("p",{style:{marginLeft:"var(--spacing-small)",opacity:.5},children:["(Found ",y.value.filtered.length," / ",y.value.entries.length,")"]})]}),y.value===null?n("select",{disabled:!0,style:{marginRight:"var(--spacing-small)"},children:n("option",{selected:!0,children:"Loading..."})}):n("select",{value:z.value.provider,onChange:e=>E.updateFilter({provider:e.target.value}),style:{marginRight:"var(--spacing-small)"},children:[n("option",{value:"all",children:"All Providers"})].concat(y.value.providers.map(e=>n("option",{value:e,selected:e===z.value.provider,children:m.drivers.hasOwnProperty(e)?m.drivers[e].name:e})))}),y.value===null?n("select",{disabled:!0,style:{marginRight:"var(--spacing-small)"},children:n("option",{selected:!0,children:"Loading..."})}):n("select",{value:z.value.author,onChange:e=>E.updateFilter({author:e.target.value}),style:{marginRight:"var(--spacing-small)"},children:[n("option",{value:"all",children:"All Authors"})].concat(y.value.authors.map(e=>n("option",{value:e,children:e})))}),n("button",{disabled:y.value===null,onClick:()=>E.loadEntries(),style:{cursor:"pointer"},children:"Refresh"})]}),n("div",{class:l.settings.reduceTransparency?"container-solid-dark":"container-glassy-dark",style:{flex:1,display:"flex",flexDirection:"column",minHeight:0},children:[n("div",{style:{width:"100%",height:"0.05rem",backgroundColor:"var(--color-foreground)",opacity:.1}}),y.value===null?n("div",{style:{padding:"var(--spacing-medium)"},children:n("p",{style:{textAlign:"center",opacity:.5},children:"Loading..."})}):n("div",{ref:t,style:{flex:1,display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"var(--spacing-small)",padding:"var(--spacing-medium)",overflowY:"scroll"},children:y.value.filtered.slice(j.value.top,j.value.bottom).map(e=>mi(e))})]})]})};l.layoutSignal.subscribe(t=>{t.entries&&y.value===null&&(E.loadEntries(),E.filterEntries())});class p{static mouse={button:{left:0,middle:0,right:0},editorX:0,editorY:0,imageX:0,imageY:0,trackpad:0};static keyboard=new Map;static strokeType=1;static strokeSize=2;static strokePoints=[];static strokeOpacity=1;static startX=null;static startY=null;static moveIndex=null;static saveConfirm=0;static skipConfirm=0;static reset(){this.strokePoints=[],this.startX=null,this.startY=null,this.moveIndex=null,this.keyboard.has("z")&&(this.saveConfirm=-1),this.keyboard.has("c")&&(this.skipConfirm=-1)}static update(e){if(m.data!==null&&(p.mouse.imageX=(this.mouse.editorX/g.camera.scale+(g.camera.x-m.data.transform.x))/m.data.transform.widthScale,p.mouse.imageY=(this.mouse.editorY/g.camera.scale+(g.camera.y-m.data.transform.y))/m.data.transform.heightScale,!l.settings.randomStrokes))if(this.mouse.button.left===1){if(this.strokeType==1||this.strokeType===2)this.startX=this.mouse.imageX,this.startY=this.mouse.imageY;else if(this.strokeType===3){for(let i=0;i<this.strokePoints.length;i++){const s=(m.data.transform.x+p.strokePoints[i].x*m.data.transform.widthScale-g.camera.x)*g.camera.scale,a=(m.data.transform.y+p.strokePoints[i].y*m.data.transform.heightScale-g.camera.y)*g.camera.scale;if(Math.hypot(s-this.mouse.editorX,a-this.mouse.editorY)<7.5*l.settings.resolution){this.moveIndex=i;break}}this.moveIndex===null&&(this.strokePoints.push({x:this.mouse.imageX,y:this.mouse.imageY}),m.renderImage())}}else if(this.mouse.button.right===1){if(this.strokeType===1||this.strokeType===2){const i=m.data.strokes[m.data.strokes.length-1];i!==void 0&&i.type===this.strokeType&&(this.startX=i.x2,this.startY=i.y2)}else if(this.strokeType===3)if(this.strokePoints.length===0){const i=m.data.strokes[m.data.strokes.length-1];i!==void 0&&i.type===3&&(this.strokePoints=m.data.strokes.splice(m.data.strokes.length-1,1)[0].points,m.renderImage())}else this.strokePoints.length>2&&(m.data.strokes.push({type:3,points:this.strokePoints}),m.renderImage()),this.strokePoints=[]}else this.mouse.button.left===2?this.moveIndex!==null&&(this.strokePoints[this.moveIndex]={x:this.mouse.imageX,y:this.mouse.imageY}):(this.mouse.button.left===3||this.mouse.button.right===3)&&((this.strokeType===1||this.strokeType===2)&&this.startX!==null&&this.startY!==null?(m.data.strokes.push({type:this.strokeType,size:this.strokeSize,x1:this.startX,y1:this.startY,x2:this.mouse.imageX,y2:this.mouse.imageY}),this.startX=null,this.startY=null,m.renderImage()):this.strokeType===3&&(this.moveIndex=null));p.strokeSize=Math.min(250/g.camera.scale,Math.max(1/g.camera.scale,p.strokeSize)),this.keyboard.get("Escape")===1?this.reset():this.isCombinationClicked(l.keybinds.changeStrokeType1)?(this.strokeType=1,this.strokePoints=[]):this.isCombinationClicked(l.keybinds.changeStrokeType2)?(this.strokeType=2,this.strokePoints=[]):this.isCombinationClicked(l.keybinds.changeStrokeType3)&&(this.strokeType=3,this.startX=null,this.startY=null),this.isCombinationClicked(l.keybinds.decreaseStrokeSize)?(this.strokeSize-=1,this.strokeSize=Math.min(100/g.camera.scale,Math.max(.5/g.camera.scale,p.strokeSize))):this.isCombinationClicked(l.keybinds.increaseStrokeSize)&&(this.strokeSize+=1,this.strokeSize=Math.min(100/g.camera.scale,Math.max(.5/g.camera.scale,p.strokeSize))),l.settings.trackpad&&this.mouse.button.middle===1&&(this.strokeSize+=5/g.camera.scale,p.strokeSize>=20/g.camera.scale&&(this.strokeSize=5/g.camera.scale)),this.isCombinationPressed(l.keybinds.moveLeft)?g.camera.xSpeed=-2.5*l.settings.moveSpeed:this.isCombinationPressed(l.keybinds.moveRight)&&(g.camera.xSpeed=2.5*l.settings.moveSpeed),this.isCombinationPressed(l.keybinds.moveUp)?g.camera.ySpeed=-2.5*l.settings.moveSpeed:this.isCombinationPressed(l.keybinds.moveDown)&&(g.camera.ySpeed=2.5*l.settings.moveSpeed),this.isCombinationPressed(l.keybinds.zoomOut)?g.camera.scaleSpeed=-.005*l.settings.scaleSpeed:this.isCombinationPressed(l.keybinds.zoomIn)&&(g.camera.scaleSpeed=.005*l.settings.scaleSpeed),this.isCombinationClicked(l.keybinds.resetCamera)?g.reset():this.isCombinationClicked(l.keybinds.changeStrokeOpacity)?(this.strokeOpacity-=.5,this.strokeOpacity<0&&(this.strokeOpacity=1),m.renderImage()):this.isCombinationClicked(l.keybinds.undoLastAction)&&(this.strokePoints.length>0?this.strokePoints.splice(this.strokePoints.length-1):m.data!==null&&m.data.strokes.length>0&&(m.data.strokes.splice(m.data.strokes.length-1),m.renderImage())),m.data!==null&&(this.isCombinationPressed(l.keybinds.skipImage)?this.skipConfirm>=0&&(this.skipConfirm+=.003*e,this.skipConfirm>1&&(m.next(),this.skipConfirm=-1)):this.skipConfirm=0,this.isCombinationPressed(l.keybinds.submitImage)?this.saveConfirm>=0&&(this.saveConfirm+=.003*e,this.saveConfirm>1&&(m.submit(),this.saveConfirm=-1)):this.saveConfirm=0),l.layout.entries&&(this.isCombinationPressed(l.keybinds.jumpToTopEntry)?E.jumpTop():this.isCombinationPressed(l.keybinds.jumpToBottomEntry)&&E.jumpBottom()),this.mouse.button.left===1?this.mouse.button.left=2:this.mouse.button.left===3&&(this.mouse.button.left=0),this.mouse.button.middle===1?this.mouse.button.middle=2:this.mouse.button.middle===3&&(this.mouse.button.middle=0),this.mouse.button.right===1?this.mouse.button.right=2:this.mouse.button.right===3&&(this.mouse.button.right=0),this.keyboard.forEach((i,s)=>{this.keyboard.set(s,2)})}static isCombinationClicked(e){if(e.modifiers.control!==this.keyboard.has("control")||e.modifiers.option!==this.keyboard.has("option")||e.modifiers.meta!==this.keyboard.has("meta")||e.modifiers.shift!==this.keyboard.has("shift"))return!1;let i=0;for(const s of e.keys)if(this.keyboard.has(s))i+=this.keyboard.get(s);else return!1;return i<e.keys.length*2}static isCombinationPressed(e){if(e.modifiers.control!==this.keyboard.has("control")||e.modifiers.option!==this.keyboard.has("option")||e.modifiers.meta!==this.keyboard.has("meta")||e.modifiers.shift!==this.keyboard.has("shift"))return!1;for(const i of e.keys)if(!this.keyboard.has(i))return!1;return!0}}window.addEventListener("mousedown",t=>{t.target===g.canvas&&(t.button===0?p.mouse.button.left=1:t.button===1?p.mouse.button.middle=1:t.button===2&&(p.mouse.button.right=1))});window.addEventListener("mouseup",t=>{t.button===0?p.mouse.button.left=3:t.button===1?p.mouse.button.middle=3:t.button===2&&(p.mouse.button.right=3)});window.addEventListener("mousemove",t=>{p.mouse.editorX=t.x*l.settings.resolution,p.mouse.editorY=t.y*l.settings.resolution});window.addEventListener("wheel",t=>{t.target===g.canvas&&(l.settings.trackpad?(t.ctrlKey===!0?Math.abs(t.deltaY-p.mouse.trackpad)>.2&&(g.camera.scaleSpeed=.002*-t.deltaY,p.mouse.trackpad=t.deltaY):(g.camera.ySpeed=t.deltaY*.5,g.camera.xSpeed=t.deltaX*.5),t.preventDefault()):p.strokeSize+=-t.deltaY/(10*g.camera.scale))},{passive:!1});window.addEventListener("keydown",t=>{if(t.target===document.body){const e=t.key.toLowerCase();p.keyboard.has(e)||p.keyboard.set(e,1)}});window.addEventListener("keyup",t=>{p.keyboard.delete(t.key.toLowerCase())});let Le=0,Be=0,ve=0,ze=0;function gi(t){const e=Math.hypot(p.mouse.imageX*g.camera.scale-Le,p.mouse.imageY*g.camera.scale-Be);e>25&&(ve=Math.atan2(p.mouse.imageY*g.camera.scale-Be,p.mouse.imageX*g.camera.scale-Le),Le+=(e-25)*Math.cos(ve),Be+=(e-25)*Math.sin(ve));let i=ve-ze;for(;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;return ze+=i*(.025*t),ze}class g{static canvas=document.getElementById("canvas-main");static ctx=this.canvas.getContext("2d");static camera={x:0,xSpeed:0,y:0,ySpeed:0,scale:1,scaleSpeed:0};static resize(){const e=this.canvas.getBoundingClientRect();this.canvas.width=e.width*l.settings.resolution,this.canvas.height=e.height*l.settings.resolution,m.updateTransform(),l.settings.fps!==0&&this.update(0)}static reset(){this.camera={x:0,xSpeed:0,y:0,ySpeed:0,scale:1,scaleSpeed:0}}static update(e){const i=this.camera.x,s=this.camera.y,a=this.camera.scale;this.camera.scale*=1+this.camera.scaleSpeed*e,this.camera.scale=Math.min(500,this.camera.scale);const r=i+p.mouse.editorX/a,o=s+p.mouse.editorY/a,d=this.camera.scale/a;if(this.camera.x=r+(i-r)/d,this.camera.y=o+(s-o)/d,this.camera.x+=this.camera.xSpeed*e/this.camera.scale*l.settings.resolution,this.camera.y+=this.camera.ySpeed*e/this.camera.scale*l.settings.resolution,this.camera.xSpeed*=Math.pow(.99,e),this.camera.ySpeed*=Math.pow(.99,e),this.camera.scaleSpeed*=Math.pow(.99,e),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.imageSmoothingEnabled=!1,m.data!==null){const u=m.data.transform;if(p.skipConfirm>0&&(this.ctx.globalAlpha=1-p.skipConfirm),this.ctx.drawImage(m.data.element,(u.x-this.camera.x)*this.camera.scale,(u.y-this.camera.y)*this.camera.scale,u.width*this.camera.scale,u.height*this.camera.scale),this.ctx.drawImage(m.canvas,(u.x-this.camera.x)*this.camera.scale,(u.y-this.camera.y)*this.camera.scale,u.width*this.camera.scale,u.height*this.camera.scale),this.ctx.globalAlpha=1,!l.settings.randomStrokes){if(this.ctx.drawImage(m.renderOverlay(),(u.x-this.camera.x)*this.camera.scale,(u.y-this.camera.y)*this.camera.scale,u.width*this.camera.scale,u.height*this.camera.scale),this.ctx.fillStyle="rgba(255,0,0,0.5)",this.ctx.strokeStyle="rgba(255,0,0,0.5)",(p.strokeType===1||p.strokeType===2)&&p.startX===null&&p.startY===null){if(this.ctx.arc(p.mouse.editorX,p.mouse.editorY,(m.data.transform.width+m.data.transform.height)*(p.strokeSize/2*.0025)*this.camera.scale,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath(),p.strokeType===1){const h=gi(e)+Math.PI/2,f=(m.data.transform.width+m.data.transform.height)*(p.strokeSize/2*.0025)*g.camera.scale,c=p.mouse.editorX+f*Math.cos(h),_=p.mouse.editorY+f*Math.sin(h),v=p.mouse.editorX+f*Math.cos(h+Math.PI),I=p.mouse.editorY+f*Math.sin(h+Math.PI);this.ctx.lineCap="butt",this.ctx.lineWidth=2.5*l.settings.resolution,this.ctx.moveTo(c,_),this.ctx.lineTo(v,I),this.ctx.stroke(),this.ctx.beginPath()}}else if(p.strokeType===3)for(const h of p.strokePoints)this.ctx.arc((m.data.transform.x+h.x*m.data.transform.widthScale-this.camera.x)*this.camera.scale,(m.data.transform.y+h.y*m.data.transform.heightScale-this.camera.y)*this.camera.scale,5*l.settings.resolution,0,2*Math.PI),this.ctx.fill(),this.ctx.beginPath()}p.saveConfirm>0&&(this.ctx.fillStyle=`rgba(255,255,255,${p.saveConfirm})`,this.ctx.fillRect((u.x-this.camera.x)*this.camera.scale,(u.y-this.camera.y)*this.camera.scale,u.width*this.camera.scale,u.height*this.camera.scale))}}}window.addEventListener("load",()=>{g.resize(),window.addEventListener("resize",()=>g.resize())});g.canvas.addEventListener("contextmenu",t=>{t.preventDefault()});g.canvas.addEventListener("click",()=>{l.updateLayout({help:!1,settings:!1,keybinds:!1,entries:!1})});const vi=()=>{const t=s=>{const a=s.substring(0,20).toLowerCase().split("");for(let r=a.length-1;r>=0;r--)"abcdefghijklmnopqrstuvwxyz0123456789".includes(a[r])||a.splice(r,1);a.length>=5&&l.updateSettings({username:a.slice(0,16).join("")})},e=s=>{g.camera.x/=l.settings.resolution,g.camera.y/=l.settings.resolution,l.updateSettings({resolution:s}),g.camera.x*=l.settings.resolution,g.camera.y*=l.settings.resolution,g.resize()},i=s=>{l.updateSettings({randomStrokes:s}),m.data!==null&&(s?(m.generateRandomStrokes(),m.renderImage()):(m.data.strokes=[],m.renderImage()))};return n("div",{class:"shadow",style:{display:l.layout.settings?"block":"none",border:"0.05rem solid ",borderRadius:"0.5rem",marginRight:"var(--spacing-medium)",marginBottom:"var(--spacing-medium)",overflow:"hidden"},children:[n("div",{class:l.settings.reduceTransparency?"container-solid-light":"container-glassy-light",style:{display:"flex",alignItems:"center",padding:"var(--spacing-medium)"},children:[n("h3",{style:{flex:1},children:"Settings"}),n("button",{onClick:()=>l.updateSettings(l.defaultSettings),children:"Reset"})]}),n("div",{class:l.settings.reduceTransparency?"container-solid-dark":"container-glassy-dark",children:[n("div",{style:{width:"100%",height:"0.05rem",backgroundColor:"var(--color-foreground)",opacity:.1}}),n("div",{style:{padding:"var(--spacing-medium)",overflowX:"scroll"},children:[n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Username:"}),n("input",{value:l.settings.username,onChange:s=>t(s.target.value)})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"FPS:"}),n("input",{type:"range",step:"10",min:"0",max:"120",value:l.settings.fps,onInput:s=>l.updateSettings({fps:parseInt(s.target.value)}),style:{marginRight:"var(--spacing-small)"}}),n("p",{children:l.settings.fps===0?"(VSync)":`(${l.settings.fps})`})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Resolution:"}),n("input",{type:"range",step:"0.1",min:"0.1",max:"2",value:l.settings.resolution,onInput:s=>e(parseFloat(s.target.value)),style:{marginRight:"var(--spacing-small)"}}),n("p",{children:l.settings.resolution===window.devicePixelRatio?"(Native)":`(${l.settings.resolution}x)`})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Preload Image:"}),n("input",{type:"range",step:"1",min:"0",max:"10",value:l.settings.preload,onInput:s=>l.updateSettings({preload:parseInt(s.target.value)}),style:{marginRight:"var(--spacing-small)"}}),n("p",{children:l.settings.preload===5?"(Default)":`(${l.settings.preload})`})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Trackpad Mode:"}),n("input",{type:"checkbox",checked:l.settings.trackpad,onChange:s=>l.updateSettings({trackpad:s.target.checked})})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Move Speed:"}),n("input",{type:"range",step:"0.1",min:"0.1",max:"2",value:l.settings.moveSpeed,onInput:s=>l.updateSettings({moveSpeed:parseFloat(s.target.value)}),style:{marginRight:"var(--spacing-small)"}}),n("p",{children:l.settings.moveSpeed===1?"(Default)":`(${l.settings.moveSpeed}x)`})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-big)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Scale Speed:"}),n("input",{type:"range",step:"0.1",min:"0.1",max:"2",value:l.settings.scaleSpeed,onInput:s=>l.updateSettings({scaleSpeed:parseFloat(s.target.value)}),style:{marginRight:"var(--spacing-small)"}}),n("p",{children:l.settings.scaleSpeed===1?"(Default)":`(${l.settings.scaleSpeed}x)`})]}),n("div",{style:{display:"flex",alignItems:"center",marginBottom:"var(--spacing-tiny)"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Random Strokes:"}),n("input",{type:"checkbox",checked:l.settings.randomStrokes,onChange:s=>i(s.target.checked)})]}),n("div",{style:{display:"flex",alignItems:"center"},children:[n("p",{style:{textWrap:"nowrap",marginRight:"var(--spacing-small)"},children:"Reduce Transparency:"}),n("input",{type:"checkbox",checked:l.settings.reduceTransparency,onChange:s=>l.updateSettings({reduceTransparency:s.target.checked})})]})]})]})]})},_i=()=>{const t=async i=>{l.updateSource({driver:i}),await m.next()},e=async i=>{l.updateSource({value:i,display:i}),await m.next()};return n("nav",{class:l.settings.reduceTransparency?"container-solid-light shadow":"container-glassy-light shadow",style:{position:"fixed",display:"flex",alignItems:"center",left:"0rem",top:"0rem",width:"100%",height:"3.5rem"},children:[n("h1",{style:{textWrap:"nowrap",marginLeft:"var(--spacing-medium)",marginRight:"var(--spacing-medium)"},children:"Dataset Editor"}),n("button",{onClick:()=>l.updateLayout({help:!l.layout.help}),style:{marginRight:"var(--spacing-medium)",cursor:"pointer"},children:"Help"}),n("button",{onClick:()=>l.updateLayout({settings:!l.layout.settings}),style:{marginRight:"var(--spacing-medium)",cursor:"pointer"},children:"Settings"}),n("button",{onClick:()=>l.updateLayout({keybinds:!l.layout.keybinds}),style:{marginRight:"var(--spacing-medium)",cursor:"pointer"},children:"Keybinds"}),l.source.duplicate?n("p",{style:{marginRight:"var(--spacing-medium)",opacity:.5},children:"(Duplicated)"}):void 0,n("div",{style:"flex: 1"}),n("select",{value:l.source.driver,disabled:l.source.locked,onChange:i=>t(i.target.value),style:{marginRight:"var(--spacing-small)"},children:Object.keys(m.drivers).map(i=>n("option",{value:m.drivers[i].id,children:m.drivers[i].name}))}),n("input",{value:l.source.display,autocomplete:"off",disabled:l.source.locked,onChange:i=>e(i.target.value),style:{width:"7.5rem",marginRight:"var(--spacing-small)"}}),n("button",{onClick:()=>l.updateLayout({entries:!l.layout.entries}),style:{marginRight:"var(--spacing-medium)",cursor:"pointer"},children:"Entries"})]})},yi=()=>n("div",{class:"shadow",style:{display:l.layout.help?"block":"none",border:"0.05rem solid ",borderRadius:"0.5rem",marginRight:"var(--spacing-medium)",marginBottom:"var(--spacing-medium)",overflow:"hidden"},children:[n("h3",{class:l.settings.reduceTransparency?"container-solid-light":"container-glassy-light",style:{padding:"var(--spacing-medium)"},children:"Help"}),n("div",{class:l.settings.reduceTransparency?"container-solid-dark":"container-glassy-dark",children:[n("div",{style:{width:"100%",height:"0.05rem",backgroundColor:"var(--color-foreground)",opacity:.1}}),n("div",{style:{padding:"var(--spacing-medium)",overflowX:"auto"},children:[n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.moveUp)}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.moveLeft)}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.moveDown)}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.moveRight)}),n("span",{style:{marginRight:"var(--spacing-tiny)"},children:"to move,"}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.zoomIn)}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.zoomOut)}),n("span",{children:"to zoom in and out."})]}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-big)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.resetCamera)}),n("span",{children:"to reset the camera."})]}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.changeStrokeType1)}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.changeStrokeType2)}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.changeStrokeType3)}),n("span",{children:"to change the stroke type."})]}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Mouse Wheel"}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.increaseStrokeSize)}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.decreaseStrokeSize)}),n("span",{children:"to change the stroke size."})]}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-big)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.changeStrokeOpacity)}),n("span",{children:"to change the stroke opacity."})]}),n("h5",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:"Stroke Type 1 or 2"}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Left Click"}),n("span",{children:"to draw."})]}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-big)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Right Click"}),n("span",{children:"to continue from the last stroke."})]}),n("h5",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:"Stroke Type 3"}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Left Click"}),n("span",{children:"to add a point or move a point."})]}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-big)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:"Right Click"}),n("span",{children:"to complete or edit the last shape."})]}),n("p",{style:{textWrap:"nowrap",marginBottom:"var(--spacing-small)"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.undoLastAction)}),n("span",{children:"to remove the last stroke or point."})]}),n("p",{style:{textWrap:"nowrap"},children:[n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.skipImage)}),n("span",{style:{marginRight:"var(--spacing-tiny)"},children:"to skip the image,"}),n("span",{class:"key",style:{marginRight:"var(--spacing-tiny)"},children:O(l.keybinds.submitImage)}),n("span",{children:"to submit."})]})]})]})]});he(n(_i,{}),document.getElementById("container-navbar"));he(n(yi,{}),document.getElementById("container-help"));he(n(vi,{}),document.getElementById("container-settings"));he(n(oi,{}),document.getElementById("container-keybinds"));he(n(fi,{}),document.getElementById("container-entries"));let je=performance.now();function Ye(){const t=performance.now()-je;je=performance.now(),document.hasFocus()&&(p.update(t),g.update(t)),l.settings.fps===0?requestAnimationFrame(Ye):setTimeout(Ye,1e3/l.settings.fps-(performance.now()-je))}let Ht=!0;async function Ce(){try{const t=await m.drivers[l.source.driver].preload(l.settings.preload);t===null?setTimeout(Ce,100):(await fetch(t.url),Ce())}catch{Ht=!1}}window.addEventListener("load",()=>{Ye(),Ce(),m.next(),l.sourceSignal.subscribe(()=>{Ht||Ce()})});
